import{f as j,C as D,c as i,a as u,u as l,h as A,w as v,b as t,l as w,d as k,i as N,j as m,o as p,F as b,g as _,t as c,k as B,v as f,e as E,z as P,B as h,m as T}from"./app-BcWCMwOt.js";import{_ as L}from"./AppLayout-CFTGGE-3.js";import{f as O}from"./helpers-DnzC1tLX.js";import{_ as S}from"./SearchableSelect-Cssv_vDV.js";import{_ as M}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{r as z}from"./ArrowLeftIcon-0HEorBsA.js";import{r as W}from"./PlusIcon-B8hfzu8H.js";import{r as G}from"./TrashIcon-BMjvIMJA.js";/* empty css            */import"./XMarkIcon-CRNWdZLr.js";import"./SunIcon-DzzMCeOx.js";import"./WrenchScrewdriverIcon-DY-0tTFT.js";import"./DocumentPlusIcon-uBg6RuAT.js";import"./TruckIcon-B0_0eEUA.js";import"./DocumentTextIcon-yFW_nzzp.js";import"./ShoppingCartIcon-DIxiZ7Mk.js";import"./MapPinIcon-D8TSkU1r.js";import"./SparklesIcon-D5CI4gvw.js";import"./CubeIcon--OZy1d70.js";import"./ClockIcon-CS5MVw6T.js";import"./CheckCircleIcon-Castq6Ch.js";import"./ShieldCheckIcon-Ct-z8SVQ.js";import"./transition-BRc784aI.js";const Q={class:"max-w-full px-4 sm:px-6 lg:px-8 mx-auto"},H={class:"grid grid-cols-1 xl:grid-cols-12 gap-6"},J={class:"xl:col-span-4 glass-card rounded-2xl p-6 space-y-4"},K=["value"],X={class:"xl:col-span-8 glass-card rounded-2xl p-6 flex flex-col"},Y={class:"flex items-center justify-between mb-4"},Z={class:"flex-1 space-y-3 overflow-y-auto max-h-[600px] pr-2 custom-scrollbar relative"},ee={class:"col-span-12 sm:col-span-4"},te=["value","onChange"],se=["value"],re={class:"col-span-4 sm:col-span-2"},ae=["onUpdate:modelValue"],le={class:"col-span-4 sm:col-span-3"},oe=["onUpdate:modelValue"],de={class:"col-span-4 sm:col-span-2 text-right"},ne={class:"text-xs font-mono font-bold text-slate-600 dark:text-slate-300"},ie={class:"col-span-1 flex justify-end"},ue=["onClick"],pe={key:0,class:"py-12 text-center"},ce={key:1,class:"py-12 text-center border-2 border-dashed border-slate-200 dark:border-slate-800 rounded-2xl"},me={class:"mt-6 pt-6 border-t border-slate-200 dark:border-slate-800"},xe={class:"flex justify-between items-center bg-slate-50 dark:bg-slate-900 dark:bg-slate-800/50 rounded-2xl p-4 border border-slate-200 dark:border-slate-700/50"},be={class:"text-2xl font-black text-slate-900 dark:text-white tracking-tight"},fe={class:"glass-card rounded-2xl p-6"},ge={class:"flex justify-end gap-3 pt-4"},ve=["disabled"],ke={__name:"Create",props:{salesOrder:Object,salesInvoice:Object,salesOrders:Array,customers:Array,warehouses:Array,products:Array},setup(x){const o=x,C=h(()=>o.salesOrders.map(s=>({id:s.id,label:`${s.so_number} - ${s.customer?.name}`}))),V=h(()=>o.customers.map(s=>({id:s.id,label:s.name}))),r=j({sales_invoice_id:o.salesInvoice?.id||null,sales_order_id:o.salesOrder?.id||o.salesInvoice?.sales_order_id||null,customer_id:o.salesOrder?.customer_id||o.salesInvoice?.sales_order?.customer_id||"",warehouse_id:o.salesOrder?.warehouse_id||"",return_date:new Date().toISOString().split("T")[0],reason:"",items:o.salesInvoice?o.salesInvoice.items.map(s=>({product_id:s.product_id,name:s.product.name,sku:s.product.sku,qty:parseFloat(s.qty),unit_price:parseFloat(s.unit_price)})):o.salesOrder?.items.map(s=>({product_id:s.product_id,name:s.product.name,sku:s.product.sku,qty:parseFloat(s.qty),unit_price:parseFloat(s.unit_price)}))||[]}),g=T(!1),y=async s=>{if(s){g.value=!0;try{const a=(await P.get(route("sales.returns.so-items",s))).data;r.customer_id=a.customer_id,r.warehouse_id=a.warehouse_id,a.items.length===0&&alert("No items available to return for this Sales Order. Only items that have been officially DELIVERED can be returned."),r.items=a.items.map(n=>({product_id:n.product_id,name:n.name,sku:n.sku,qty:parseFloat(n.returnable_qty),unit_price:parseFloat(n.unit_price)}))}catch(e){console.error("Error fetching SO Items:",e),alert("Failed to load Sales Order items. Please check if the SO is correct and has been delivered.")}finally{g.value=!1}}},q=()=>{r.items.push({product_id:"",name:"",sku:"",qty:1,unit_price:0})},I=s=>{r.items.splice(s,1)},F=(s,e)=>{r.items[s].product_id=e.id,r.items[s].name=e.name,r.items[s].sku=e.sku},U=h(()=>r.items.reduce((s,e)=>s+e.qty*e.unit_price,0)),R=()=>{r.post(route("sales.returns.store"))};return D(()=>{r.sales_order_id&&r.items.length===0&&y(r.sales_order_id)}),(s,e)=>(p(),i(b,null,[u(l(A),{title:"Create Sales Return"}),u(L,{title:"Sales Returns"},{default:v(()=>[t("div",Q,[u(l(w),{href:s.route("sales.returns.index"),class:"inline-flex items-center gap-2 mb-4 text-sm text-slate-500 dark:text-slate-400 hover:text-slate-900 dark:text-white"},{default:v(()=>[u(l(z),{class:"h-4 w-4"}),e[6]||(e[6]=k(" Back to List ",-1))]),_:1},8,["href"]),t("form",{onSubmit:N(R,["prevent"]),class:"space-y-6"},[t("div",H,[t("div",J,[e[12]||(e[12]=t("h3",{class:"text-lg font-semibold text-slate-900 dark:text-white mb-4"},"Return Info",-1)),t("div",null,[e[7]||(e[7]=t("label",{class:"block text-sm font-medium text-slate-500 dark:text-slate-400 mb-1"},"Sales Order (Optional)",-1)),u(S,{modelValue:l(r).sales_order_id,"onUpdate:modelValue":e[0]||(e[0]=a=>l(r).sales_order_id=a),options:C.value,placeholder:"Search SO number...",onChange:e[1]||(e[1]=a=>y(l(r).sales_order_id))},null,8,["modelValue","options"])]),t("div",null,[e[8]||(e[8]=t("label",{class:"block text-sm font-medium text-slate-500 dark:text-slate-400 mb-1"},"Customer",-1)),u(S,{modelValue:l(r).customer_id,"onUpdate:modelValue":e[2]||(e[2]=a=>l(r).customer_id=a),options:V.value,placeholder:"Search Customer...",required:""},null,8,["modelValue","options"])]),t("div",null,[e[10]||(e[10]=t("label",{class:"block text-sm font-medium text-slate-500 dark:text-slate-400 mb-1"},"Warehouse",-1)),m(t("select",{"onUpdate:modelValue":e[3]||(e[3]=a=>l(r).warehouse_id=a),class:"w-full rounded-xl border-0 bg-slate-50 dark:bg-slate-800 py-2.5 text-slate-900 dark:text-white focus:ring-2 focus:ring-blue-500/50",required:""},[e[9]||(e[9]=t("option",{value:""},"Select Warehouse",-1)),(p(!0),i(b,null,_(x.warehouses,a=>(p(),i("option",{key:a.id,value:a.id},c(a.name),9,K))),128))],512),[[B,l(r).warehouse_id]])]),t("div",null,[e[11]||(e[11]=t("label",{class:"block text-sm font-medium text-slate-500 dark:text-slate-400 mb-1"},"Date",-1)),m(t("input",{type:"date","onUpdate:modelValue":e[4]||(e[4]=a=>l(r).return_date=a),class:"w-full rounded-xl border-0 bg-slate-50 dark:bg-slate-800 py-2.5 text-slate-900 dark:text-white focus:ring-2 focus:ring-blue-500/50",required:""},null,512),[[f,l(r).return_date]])])]),t("div",X,[t("div",Y,[e[14]||(e[14]=t("h3",{class:"text-lg font-semibold text-slate-900 dark:text-white"},"Items Returned",-1)),t("button",{type:"button",onClick:q,class:"text-sm font-medium text-blue-400 hover:text-blue-300 flex items-center gap-1"},[u(l(W),{class:"h-4 w-4"}),e[13]||(e[13]=k(" Add Item ",-1))])]),t("div",Z,[e[18]||(e[18]=t("div",{class:"grid grid-cols-12 gap-3 px-3 py-2 mb-2 hidden sm:grid sticky top-0 z-10 bg-white dark:bg-slate-900 border-b border-slate-100 dark:border-slate-800"},[t("div",{class:"col-span-12 sm:col-span-4"},[t("span",{class:"text-[10px] font-bold text-slate-500 uppercase tracking-wider"},"Product")]),t("div",{class:"col-span-4 sm:col-span-2 text-right pr-2"},[t("span",{class:"text-[10px] font-bold text-slate-500 uppercase tracking-wider"},"Qty")]),t("div",{class:"col-span-4 sm:col-span-3 text-right pr-2"},[t("span",{class:"text-[10px] font-bold text-slate-500 uppercase tracking-wider"},"Price")]),t("div",{class:"col-span-4 sm:col-span-2 text-right pr-2"},[t("span",{class:"text-[10px] font-bold text-slate-500 uppercase tracking-wider"},"Total")]),t("div",{class:"col-span-1"})],-1)),(p(!0),i(b,null,_(l(r).items,(a,n)=>(p(),i("div",{key:n,class:"grid grid-cols-12 gap-3 items-center bg-slate-50 dark:bg-slate-800/20 p-3 rounded-xl hover:bg-slate-50 dark:hover:bg-slate-800/50 dark:bg-slate-800/40 transition-all border border-transparent hover:border-slate-200 dark:border-slate-700/50 shadow-sm"},[t("div",ee,[t("select",{value:a.product_id,onChange:d=>F(n,x.products.find($=>$.id==d.target.value)),class:"w-full rounded-lg border-0 bg-slate-50 dark:bg-slate-800 py-2 text-xs text-slate-900 dark:text-white focus:ring-1 focus:ring-blue-500",required:""},[e[15]||(e[15]=t("option",{value:""},"Select Product",-1)),(p(!0),i(b,null,_(x.products,d=>(p(),i("option",{key:d.id,value:d.id},"["+c(d.sku)+"] "+c(d.name),9,se))),128))],40,te)]),t("div",re,[m(t("input",{type:"number","onUpdate:modelValue":d=>a.qty=d,min:"0.0001",step:"any",class:"w-full rounded-lg border-0 bg-slate-50 dark:bg-slate-800 py-2 text-xs text-slate-900 dark:text-white focus:ring-1 focus:ring-blue-500 text-right font-mono",required:""},null,8,ae),[[f,a.qty]])]),t("div",le,[m(t("input",{type:"number","onUpdate:modelValue":d=>a.unit_price=d,step:"any",class:"w-full rounded-lg border-0 bg-slate-50 dark:bg-slate-800 py-2 text-xs text-slate-900 dark:text-white focus:ring-1 focus:ring-blue-500 text-right font-mono",required:""},null,8,oe),[[f,a.unit_price]])]),t("div",de,[t("span",ne,c(l(O)(a.qty*a.unit_price)),1)]),t("div",ie,[t("button",{type:"button",onClick:d=>I(n),class:"p-1.5 text-slate-500 hover:text-red-400 rounded-lg hover:bg-slate-700/50 transition-colors"},[u(l(G),{class:"h-4 w-4"})],8,ue)])]))),128)),g.value?(p(),i("div",pe,[...e[16]||(e[16]=[t("div",{class:"inline-block animate-spin rounded-full h-8 w-8 border-4 border-blue-500 border-t-transparent"},null,-1),t("p",{class:"mt-2 text-sm text-slate-500 font-medium"},"Fetching items from Sales Order...",-1)])])):l(r).items.length===0?(p(),i("div",ce,[...e[17]||(e[17]=[t("p",{class:"text-sm text-slate-500 italic"},"No items added yet. Search SO or manually add items.",-1)])])):E("",!0)]),t("div",me,[t("div",xe,[e[19]||(e[19]=t("span",{class:"text-slate-500 dark:text-slate-400 font-bold uppercase tracking-widest text-xs"},"Grand Total",-1)),t("span",be,c(l(O)(U.value)),1)])])])]),t("div",fe,[e[20]||(e[20]=t("label",{class:"block text-xs font-bold text-slate-500 uppercase tracking-widest mb-3"},"Reason for Return",-1)),m(t("textarea",{"onUpdate:modelValue":e[5]||(e[5]=a=>l(r).reason=a),rows:"3",class:"w-full rounded-xl border-0 bg-slate-50 dark:bg-slate-800 text-slate-900 dark:text-white focus:ring-2 focus:ring-blue-500/50 text-sm py-3",placeholder:"e.g. Defective items, customer changed mind..."},null,512),[[f,l(r).reason]])]),t("div",ge,[u(l(w),{href:s.route("sales.returns.index"),class:"px-8 py-3 rounded-xl bg-slate-50 dark:bg-slate-800 text-sm font-bold text-slate-600 dark:text-slate-300 hover:bg-slate-700 transition-all border border-slate-200 dark:border-slate-700"},{default:v(()=>[...e[21]||(e[21]=[k("Cancel",-1)])]),_:1},8,["href"]),t("button",{type:"submit",class:"px-8 py-3 rounded-xl bg-blue-600 text-sm font-bold text-white dark:text-white hover:bg-blue-500 shadow-xl shadow-blue-900/30 transition-all active:scale-95",disabled:l(r).processing},c(l(r).processing?"Saving...":"Save Return"),9,ve)])],32)])]),_:1})],64))}},Me=M(ke,[["__scopeId","data-v-09da49c0"]]);export{Me as default};
