import{f as j,q as I,C as P,c as i,a as c,u as o,h as F,w as V,b as t,l as X,o as a,t as n,e as p,i as B,d as g,j as m,v as b,F as y,g as R,n as h,x as T,s as O,B as G}from"./app-CGAYEMLV.js";import{s as M,_ as A}from"./AppLayout-pcWSJUwb.js";import{_ as z}from"./SearchableSelect-C03zQMYB.js";import{a as E,f as k}from"./helpers-DzPfLsau.js";import{r as L}from"./ArrowLeftIcon-BuYVtvyd.js";import{r as Q}from"./XCircleIcon-VGtFUE2w.js";import{r as S}from"./DocumentTextIcon-DPNDbCJ2.js";import{r as C}from"./CalendarIcon-D9hw5nz-.js";import{r as U}from"./PlusIcon-CRPNCjk5.js";import{r as H}from"./DocumentPlusIcon-DVpTdb5w.js";/* empty css            */import"./XMarkIcon-CDfMTWhX.js";import"./SunIcon-CR0rIyXt.js";import"./WrenchScrewdriverIcon-D52asUGE.js";import"./TruckIcon-D3spUp-g.js";import"./ShoppingCartIcon-Cb0EUpxa.js";import"./MapPinIcon-k7_OKdPW.js";import"./SparklesIcon-Bd4AX5UM.js";import"./CubeIcon-CdhOWFeo.js";import"./ClockIcon-DDq8GnAr.js";import"./CheckCircleIcon-NDF4lCA2.js";import"./ShieldCheckIcon-DzXXDVxC.js";import"./transition-B8B0aFZX.js";const J={class:"max-w-7xl mx-auto"},K={class:"flex items-center gap-4 mb-8"},W={key:0,class:"mb-8 rounded-2xl bg-red-500/10 border border-red-500/20 p-4 flex items-start gap-3"},Y={key:0,class:"text-xs text-red-400 mt-1"},Z={key:1,class:"text-xs text-red-400 mt-1"},tt={class:"lg:col-span-8 space-y-8"},et={class:"glass-card rounded-3xl p-6 shadow-sm overflow-hidden relative"},st={class:"absolute top-0 right-0 p-8 opacity-5"},ot={class:"grid grid-cols-1 sm:grid-cols-2 gap-6 relative z-10"},rt={class:"space-y-2"},lt={key:0,class:"text-xs text-red-500 mt-1"},at={class:"space-y-2"},it={class:"relative group"},dt={key:0,class:"text-xs text-red-500 mt-1"},nt={class:"space-y-2"},ct={class:"relative group"},ut={key:0,class:"text-xs text-red-500 mt-1"},pt={class:"space-y-2"},xt={class:"relative group"},mt={key:0,class:"text-xs text-red-500 mt-1"},bt={key:0,class:"glass-card rounded-3xl p-6 shadow-sm overflow-hidden"},gt={key:0,class:"text-center py-10 bg-slate-50 dark:bg-slate-800/30 rounded-2xl border border-dashed border-slate-200 dark:border-slate-700"},_t={key:1,class:"space-y-3"},ht=["onClick"],ft={key:0,class:"text-slate-900 dark:text-white"},vt={key:1},wt={class:"flex-1 min-w-0"},yt={class:"flex justify-between items-start"},kt={class:"text-sm font-bold text-slate-900 dark:text-white"},St={key:0,class:"text-xs text-slate-500 mt-0.5"},$t={class:"text-right"},It={class:"text-xs font-bold text-slate-600 dark:text-slate-300"},Vt={class:"text-[10px] text-slate-500 uppercase mt-0.5"},Rt={class:"glass-card rounded-3xl p-6 shadow-sm overflow-hidden min-h-[400px]"},Ct={class:"overflow-x-auto -mx-6 px-6"},Ut={class:"min-w-full divide-y divide-slate-100 dark:divide-slate-800 text-left"},qt={class:"divide-y divide-slate-100 dark:divide-slate-800"},Dt={class:"py-4"},Nt={class:"text-sm font-medium text-slate-900 dark:text-white"},jt={class:"text-[10px] text-slate-500 font-mono"},Pt={class:"py-4 px-4 text-right"},Ft=["onUpdate:modelValue","onInput"],Xt={key:0,class:"text-[9px] text-red-500 mt-1"},Bt={class:"py-4 px-4 text-right"},Tt=["onUpdate:modelValue","onInput","onChange"],Ot={key:0,class:"text-[9px] text-red-500 mt-1"},Gt={class:"py-4 px-4 text-right"},Mt=["onUpdate:modelValue","onInput"],At={class:"py-4 text-right text-sm font-bold text-slate-900 dark:text-white pr-2 font-mono"},zt={key:0},Et={class:"lg:col-span-4 space-y-8"},Lt={class:"glass-card rounded-3xl p-6 shadow-lg sticky top-8"},Qt={class:"text-lg font-bold text-slate-900 dark:text-white mb-6 flex items-center gap-2"},Ht={class:"space-y-4"},Jt={class:"flex justify-between text-sm py-2 border-b border-slate-200 dark:border-slate-800"},Kt={class:"text-slate-900 dark:text-white font-mono"},Wt={class:"flex justify-between items-center text-sm py-1"},Yt={class:"flex justify-between items-center text-sm py-1"},Zt={class:"flex items-center gap-2"},te={class:"flex items-center gap-1 bg-slate-50 dark:bg-slate-800 rounded-lg px-2 py-1"},ee={class:"text-slate-900 dark:text-white font-mono"},se={class:"mt-4 pt-4 border-t-2 border-blue-500/20 flex justify-between items-center"},oe={class:"text-xl font-bold bg-gradient-to-r from-white to-slate-400 bg-clip-text text-transparent font-mono"},re={class:"mt-8 space-y-4"},le={class:"space-y-2"},ae=["disabled"],ie={class:"relative flex items-center justify-center gap-2"},de={key:1,class:"h-5 w-5 border-2 border-white/30 border-t-white rounded-full animate-spin"},ne={key:0,class:"text-[10px] text-center text-amber-500/70 animate-pulse font-medium italic"},Ne={__name:"Form",props:{suppliers:Array,unbilledReceipts:Array,preselectedSupplier:String,preselectedPO:String,preselectedGR:String,nextInvoiceNumber:String},setup(f){const x=f,s=j({supplier_id:x.preselectedSupplier||"",purchase_order_id:x.preselectedPO||null,invoice_number:x.nextInvoiceNumber||"",invoice_date:new Date().toISOString().split("T")[0],due_date:"",subtotal:0,tax_percent:11,tax_amount:0,discount_total:0,total_amount:0,notes:"",items:[]}),q=G(()=>x.suppliers.map(l=>({id:l.id,label:`[${l.code}] ${l.name}`,...l}))),D=l=>{if(!l){s.items=[];return}O.get(route("purchasing.invoices.create"),{supplier_id:l},{preserveState:!0,preserveScroll:!0,onSuccess:e=>{}})},$=(l,e)=>{e?(l.items.forEach(r=>{if(!s.items.some(d=>d.goods_receipt_item_id===r.id)){const d=parseFloat(r.qty_received-(r.qty_invoiced||0));if(d>0){const u=parseFloat(r.unit_cost);s.items.push({goods_receipt_item_id:r.id,product_id:r.product_id,name:r.product?.name,qty:d,unit_price:u,discount_percent:0,discount_amount:0,subtotal:d*u})}}}),!s.purchase_order_id&&l.purchase_order_id&&(s.purchase_order_id=l.purchase_order_id)):s.items=s.items.filter(r=>!l.items.some(d=>d.id===r.goods_receipt_item_id))},v=l=>{const e=s.items[l],r=(e.qty||0)*(e.unit_price||0);e.discount_amount=r*((e.discount_percent||0)/100),e.subtotal=r-e.discount_amount,w()},w=()=>{s.subtotal=s.items.reduce((l,e)=>l+(e.subtotal||0),0),s.tax_amount=(s.subtotal-s.discount_total)*(s.tax_percent/100),s.total_amount=s.subtotal-s.discount_total+s.tax_amount};I(()=>s.items,()=>w(),{deep:!0}),I(()=>[s.tax_percent,s.discount_total],()=>w());const N=()=>{s.post(route("purchasing.invoices.store"))},_=l=>{const e=x.unbilledReceipts.find(r=>r.id===l);return e?e.items.some(r=>s.items.some(d=>d.goods_receipt_item_id===r.id)):!1};return P(()=>{if(x.preselectedGR&&x.unbilledReceipts.length>0){const l=x.unbilledReceipts.find(e=>e.id==x.preselectedGR);l&&$(l,!0)}}),(l,e)=>(a(),i(y,null,[c(o(F),{title:"Create Purchase Invoice"}),c(A,{title:"Create Purchase Invoice"},{default:V(()=>[t("div",J,[t("div",K,[c(o(X),{href:l.route("purchasing.invoices.index"),class:"p-2.5 rounded-xl glass-card text-slate-500 dark:text-slate-400 hover:text-slate-900 dark:text-white hover:border-slate-200 dark:border-slate-700 transition-all"},{default:V(()=>[c(o(L),{class:"h-5 w-5"})]),_:1},8,["href"]),e[8]||(e[8]=t("div",null,[t("h2",{class:"text-2xl font-bold text-slate-900 dark:text-white tracking-tight"},"Record Supplier Invoice"),t("p",{class:"text-sm text-slate-500 mt-1"},"Convert Received Goods into a Billing Statement")],-1))]),l.$page.props.flash?.error||Object.keys(o(s).errors).length>0?(a(),i("div",W,[c(o(Q),{class:"h-6 w-6 text-red-500 shrink-0"}),t("div",null,[e[9]||(e[9]=t("h4",{class:"font-bold text-red-500 text-sm"},"Action Failed",-1)),l.$page.props.flash?.error?(a(),i("p",Y,n(l.$page.props.flash.error),1)):(a(),i("p",Z,"Please check the form for validation errors."))])])):p("",!0),t("form",{onSubmit:B(N,["prevent"]),class:"grid grid-cols-1 lg:grid-cols-12 gap-8"},[t("div",tt,[t("div",et,[t("div",st,[c(o(S),{class:"h-32 w-32 text-slate-900 dark:text-white"})]),e[14]||(e[14]=t("h3",{class:"text-lg font-bold text-slate-900 dark:text-white mb-6 flex items-center gap-2"},[t("div",{class:"h-6 w-1 bg-blue-500 rounded-full"}),g(" Invoice Details ")],-1)),t("div",ot,[t("div",rt,[e[10]||(e[10]=t("label",{class:"text-xs font-bold text-slate-500 uppercase tracking-widest ml-1"},"Supplier",-1)),c(z,{modelValue:o(s).supplier_id,"onUpdate:modelValue":e[0]||(e[0]=r=>o(s).supplier_id=r),options:q.value,onChange:D,placeholder:"Select Supplier..."},null,8,["modelValue","options"]),o(s).errors.supplier_id?(a(),i("div",lt,n(o(s).errors.supplier_id),1)):p("",!0)]),t("div",at,[e[11]||(e[11]=t("label",{class:"text-xs font-bold text-slate-500 uppercase tracking-widest ml-1"},"Invoice Number",-1)),t("div",it,[c(o(S),{class:"absolute left-3 top-1/2 -translate-y-1/2 h-5 w-5 text-slate-600 group-focus-within:text-blue-500 transition-colors"}),m(t("input",{type:"text","onUpdate:modelValue":e[1]||(e[1]=r=>o(s).invoice_number=r),class:"w-full rounded-xl border-0 bg-slate-50 dark:bg-slate-800 py-2.5 pl-10 text-sm text-slate-900 dark:text-white focus:ring-2 focus:ring-blue-500/50 transition-all",placeholder:"PINV-XXXXXXXX",required:""},null,512),[[b,o(s).invoice_number]])]),o(s).errors.invoice_number?(a(),i("div",dt,n(o(s).errors.invoice_number),1)):p("",!0)]),t("div",nt,[e[12]||(e[12]=t("label",{class:"text-xs font-bold text-slate-500 uppercase tracking-widest ml-1"},"Invoice Date",-1)),t("div",ct,[c(o(C),{class:"absolute left-3 top-1/2 -translate-y-1/2 h-5 w-5 text-slate-600 group-focus-within:text-blue-500 transition-colors"}),m(t("input",{type:"date","onUpdate:modelValue":e[2]||(e[2]=r=>o(s).invoice_date=r),class:"w-full rounded-xl border-0 bg-slate-50 dark:bg-slate-800 py-2.5 pl-10 text-sm text-slate-900 dark:text-white focus:ring-2 focus:ring-blue-500/50 transition-all",required:""},null,512),[[b,o(s).invoice_date]])]),o(s).errors.invoice_date?(a(),i("div",ut,n(o(s).errors.invoice_date),1)):p("",!0)]),t("div",pt,[e[13]||(e[13]=t("label",{class:"text-xs font-bold text-slate-500 uppercase tracking-widest ml-1"},"Due Date",-1)),t("div",xt,[c(o(C),{class:"absolute left-3 top-1/2 -translate-y-1/2 h-5 w-5 text-slate-600 group-focus-within:text-blue-500 transition-colors"}),m(t("input",{type:"date","onUpdate:modelValue":e[3]||(e[3]=r=>o(s).due_date=r),class:"w-full rounded-xl border-0 bg-slate-50 dark:bg-slate-800 py-2.5 pl-10 text-sm text-slate-900 dark:text-white focus:ring-2 focus:ring-blue-500/50 transition-all"},null,512),[[b,o(s).due_date]])]),o(s).errors.due_date?(a(),i("div",mt,n(o(s).errors.due_date),1)):p("",!0)])])]),o(s).supplier_id?(a(),i("div",bt,[e[16]||(e[16]=t("h3",{class:"text-lg font-bold text-slate-900 dark:text-white mb-6 flex items-center justify-between"},[t("div",{class:"flex items-center gap-2"},[t("div",{class:"h-6 w-1 bg-amber-500 rounded-full"}),g(" Pending Receipts ")]),t("span",{class:"text-[10px] bg-amber-500/10 text-amber-500 px-2 py-1 rounded-lg uppercase tracking-widest"},"Select to convert")],-1)),f.unbilledReceipts.length===0?(a(),i("div",gt,[c(o(S),{class:"h-10 w-10 text-slate-600 mx-auto mb-3"}),e[15]||(e[15]=t("p",{class:"text-slate-500 dark:text-slate-400 text-sm italic"},"No unconverted goods receipts found for this supplier.",-1))])):(a(),i("div",_t,[(a(!0),i(y,null,R(f.unbilledReceipts,r=>(a(),i("div",{key:r.id,class:h(["flex items-center gap-4 p-4 rounded-2xl border transition-all cursor-pointer",_(r.id)?"bg-blue-500/10 border-blue-500/50 shadow-lg shadow-blue-500/5":"bg-slate-50 dark:bg-slate-900 dark:bg-slate-800/50 border-transparent hover:bg-slate-50 dark:hover:bg-slate-800/50 dark:bg-slate-800 hover:border-slate-200 dark:border-slate-700"]),onClick:d=>$(r,!_(r.id))},[t("div",{class:h(["flex h-10 w-10 items-center justify-center rounded-xl transition-colors",_(r.id)?"bg-blue-500 text-slate-900 dark:text-white":"bg-slate-700 text-slate-500 dark:text-slate-400"])},[_(r.id)?(a(),i("div",ft,[c(o(U),{class:"h-5 w-5 rotate-45"})])):(a(),i("div",vt,[c(o(U),{class:"h-5 w-5"})]))],2),t("div",wt,[t("div",yt,[t("div",null,[t("div",kt,n(r.grn_number),1),r.purchase_order?(a(),i("div",St,"PO Ref: "+n(r.purchase_order.po_number),1)):p("",!0)]),t("div",$t,[t("div",It,"Items: "+n(r.items.length),1),t("div",Vt,n(new Date(r.receipt_date).toLocaleDateString()),1)])])])],10,ht))),128))]))])):p("",!0),t("div",Rt,[e[19]||(e[19]=t("h3",{class:"text-lg font-bold text-slate-900 dark:text-white mb-6 flex items-center gap-2"},[t("div",{class:"h-6 w-1 bg-emerald-500 rounded-full"}),g(" Invoice Items ")],-1)),t("div",Ct,[t("table",Ut,[e[18]||(e[18]=t("thead",null,[t("tr",null,[t("th",{class:"pb-4 text-xs font-bold text-slate-500 uppercase tracking-widest pl-2"},"Product"),t("th",{class:"pb-4 text-xs font-bold text-slate-500 uppercase tracking-widest text-right px-4"},"Qty"),t("th",{class:"pb-4 text-xs font-bold text-slate-500 uppercase tracking-widest text-right px-4"},"Unit Cost"),t("th",{class:"pb-4 text-xs font-bold text-slate-500 uppercase tracking-widest text-right px-4"},"Disc %"),t("th",{class:"pb-4 text-xs font-bold text-slate-500 uppercase tracking-widest text-right pr-2"},"Subtotal")])],-1)),t("tbody",qt,[(a(!0),i(y,null,R(o(s).items,(r,d)=>(a(),i("tr",{key:d,class:"group"},[t("td",Dt,[t("div",Nt,n(r.name),1),t("div",jt,"ID: "+n(r.goods_receipt_item_id),1)]),t("td",Pt,[m(t("input",{type:"number","onUpdate:modelValue":u=>r.qty=u,onInput:u=>v(d),step:"any",class:h(["w-20 rounded-lg border-0 bg-slate-50 dark:bg-slate-800 py-1.5 text-xs text-slate-900 dark:text-white focus:ring-1 focus:ring-blue-500 text-right",{"ring-1 ring-red-500":o(s).errors[`items.${d}.qty`]}])},null,42,Ft),[[b,r.qty]]),o(s).errors[`items.${d}.qty`]?(a(),i("div",Xt,n(o(s).errors[`items.${d}.qty`]),1)):p("",!0)]),t("td",Bt,[m(t("input",{type:"number","onUpdate:modelValue":u=>r.unit_price=u,onInput:u=>v(d),onChange:u=>r.unit_price=Math.round(r.unit_price),step:"any",class:h(["w-24 rounded-lg border-0 bg-slate-50 dark:bg-slate-800 py-1.5 text-xs text-slate-900 dark:text-white focus:ring-1 focus:ring-blue-500 text-right font-mono",{"ring-1 ring-red-500":o(s).errors[`items.${d}.unit_price`]}])},null,42,Tt),[[b,r.unit_price]]),o(s).errors[`items.${d}.unit_price`]?(a(),i("div",Ot,n(o(s).errors[`items.${d}.unit_price`]),1)):p("",!0)]),t("td",Gt,[m(t("input",{type:"number","onUpdate:modelValue":u=>r.discount_percent=u,onInput:u=>v(d),min:"0",max:"100",class:"w-16 rounded-lg border-0 bg-slate-50 dark:bg-slate-800 py-1.5 text-xs text-slate-900 dark:text-white focus:ring-1 focus:ring-blue-500 text-right"},null,40,Mt),[[b,r.discount_percent]])]),t("td",At,n(o(E)(r.subtotal)),1)]))),128)),o(s).items.length===0?(a(),i("tr",zt,[...e[17]||(e[17]=[t("td",{colspan:"5",class:"py-12 text-center text-slate-600 italic"}," Select one or more receipts above to add items. ",-1)])])):p("",!0)])])])])]),t("div",Et,[t("div",Lt,[t("h3",Qt,[c(o(M),{class:"h-5 w-5 text-blue-400"}),e[20]||(e[20]=g(" Bill Summary ",-1))]),t("div",Ht,[t("div",Jt,[e[21]||(e[21]=t("span",{class:"text-slate-500 uppercase tracking-widest text-[10px] font-bold"},"Subtotal",-1)),t("span",Kt,n(o(k)(o(s).subtotal)),1)]),t("div",Wt,[e[22]||(e[22]=t("span",{class:"text-slate-500 uppercase tracking-widest text-[10px] font-bold"},"Discount Total",-1)),m(t("input",{type:"number","onUpdate:modelValue":e[4]||(e[4]=r=>o(s).discount_total=r),onChange:e[5]||(e[5]=r=>o(s).discount_total=Math.round(o(s).discount_total)),class:"w-32 rounded-lg border-0 bg-slate-50 dark:bg-slate-800 py-1.5 text-xs text-slate-900 dark:text-white focus:ring-1 focus:ring-blue-500 text-right font-mono"},null,544),[[b,o(s).discount_total]])]),t("div",Yt,[t("div",Zt,[e[24]||(e[24]=t("span",{class:"text-slate-500 uppercase tracking-widest text-[10px] font-bold"},"Tax Rate",-1)),t("div",te,[m(t("input",{type:"number","onUpdate:modelValue":e[6]||(e[6]=r=>o(s).tax_percent=r),class:"w-8 border-0 bg-transparent p-0 text-[10px] text-slate-900 dark:text-white focus:ring-0 text-center"},null,512),[[b,o(s).tax_percent]]),e[23]||(e[23]=t("span",{class:"text-[10px] text-slate-500 font-bold"},"%",-1))])]),t("span",ee,n(o(k)(o(s).tax_amount)),1)]),t("div",se,[e[25]||(e[25]=t("span",{class:"text-blue-400 font-bold text-sm uppercase tracking-tighter"},"Grand Total",-1)),t("span",oe,n(o(k)(o(s).total_amount)),1)]),t("div",re,[t("div",le,[e[26]||(e[26]=t("label",{class:"text-[10px] font-bold text-slate-500 uppercase tracking-widest ml-1"},"Notes",-1)),m(t("textarea",{"onUpdate:modelValue":e[7]||(e[7]=r=>o(s).notes=r),rows:"3",class:"w-full rounded-2xl border-0 bg-slate-50 dark:bg-slate-800 py-2.5 text-sm text-slate-900 dark:text-white placeholder:text-slate-600 focus:ring-2 focus:ring-blue-500/50 transition-all",placeholder:"Add internal notes or billing comments..."},null,512),[[b,o(s).notes]])]),t("button",{type:"submit",disabled:o(s).processing||o(s).items.length===0,class:"w-full relative group overflow-hidden rounded-2xl bg-gradient-to-r from-blue-600 to-indigo-600 p-4 text-center text-sm font-bold text-slate-900 dark:text-white shadow-xl shadow-blue-500/20 hover:from-blue-500 hover:to-indigo-500 transition-all disabled:opacity-50 disabled:grayscale"},[e[27]||(e[27]=t("div",{class:"absolute inset-0 bg-white/20 translate-y-full group-hover:translate-y-0 transition-transform duration-300"},null,-1)),t("div",ie,[o(s).processing?(a(),i("div",de)):(a(),T(o(H),{key:0,class:"h-5 w-5"})),g(" "+n(o(s).processing?"Recording Invoice...":"Finalize & Record"),1)])],8,ae),o(s).items.length===0?(a(),i("p",ne," Select receipts to enable submission ")):p("",!0)])])])])],32)])]),_:1})],64))}};export{Ne as default};
