import{f as Q,C as j,c as n,a as u,u as a,h as N,w as f,b as e,l as h,d as k,i as B,j as m,o as p,F as v,g as w,t as b,k as D,v as g,n as I,e as _,B as q}from"./app-CayNR7xr.js";import{_ as M}from"./AppLayout-CxSqD9pE.js";import{_ as T}from"./SearchableSelect-B4phZEgq.js";import{f as y}from"./helpers-DnzC1tLX.js";import{r as A}from"./ArrowLeftIcon-CeuB3hYS.js";import{r as E}from"./PlusIcon-BAmLwBQG.js";import{r as O}from"./TrashIcon-B3rD1G8B.js";/* empty css            */import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./XMarkIcon-CORBeH5J.js";import"./SunIcon-DJ86yPMz.js";import"./WrenchScrewdriverIcon-DLjNbDid.js";import"./DocumentPlusIcon-CIl8VrD4.js";import"./TruckIcon-CohYRouj.js";import"./DocumentTextIcon-DuA3ifPK.js";import"./ShoppingCartIcon-C5Ywncrw.js";import"./MapPinIcon-BcP74bVW.js";import"./SparklesIcon-C2-z30Dk.js";import"./CubeIcon-BpUmjU0R.js";import"./ClockIcon-IDrEBOJl.js";import"./CheckCircleIcon-Dh_6F0dd.js";import"./ShieldCheckIcon-Bx1PyrLf.js";import"./transition-D1oyL_ax.js";const z={class:"max-w-full px-4 sm:px-6 lg:px-8 mx-auto"},L={class:"grid grid-cols-1 xl:grid-cols-12 gap-6"},R={class:"xl:col-span-4 glass-card rounded-2xl p-6 space-y-4"},W=["value"],G=["value"],H={class:"xl:col-span-8 glass-card rounded-2xl p-6"},J={class:"flex items-center justify-between mb-4"},K={class:"space-y-2 max-h-[600px] overflow-y-auto custom-scrollbar relative pr-2"},X={class:"col-span-12 sm:col-span-5"},Y={class:"col-span-4 sm:col-span-2"},Z=["onUpdate:modelValue"],tt={class:"col-span-4 sm:col-span-2"},et=["onUpdate:modelValue"],st={key:0,class:"mt-1 flex items-center gap-1"},lt=["title"],ot={class:"col-span-4 sm:col-span-2"},at={class:"w-full text-xs text-slate-900 dark:text-white font-bold text-right truncate"},rt={class:"col-span-12 sm:col-span-1 flex justify-end"},dt=["onClick"],it={class:"mt-4 pt-4 border-t border-slate-200 dark:border-slate-800 flex justify-end"},nt={class:"text-right"},ut={class:"text-xl font-bold text-slate-900 dark:text-white"},pt={class:"glass-card rounded-2xl p-6"},ct={class:"flex justify-end gap-3"},xt=["disabled"],Mt={__name:"Edit",props:{quotation:Object,customers:Array,products:Array},setup(x){const d=x,l=Q({customer_id:"",quotation_date:"",valid_until:"",notes:"",items:[]});j(()=>{l.customer_id=d.quotation.customer_id,l.quotation_date=d.quotation.quotation_date.split("T")[0],l.valid_until=d.quotation.valid_until.split("T")[0],l.notes=d.quotation.notes,d.quotation.items&&d.quotation.items.length>0?l.items=d.quotation.items.map(o=>({product_id:o.product_id,qty:parseFloat(o.qty),unit_price:parseFloat(o.unit_price)})):l.items=[{product_id:"",qty:1,unit_price:0}]});const V=q(()=>d.products?d.products.filter(o=>o&&!o.name.startsWith("SO-")).map(o=>({id:o.id,label:`[${o.sku||"#"+o.id}] ${o.name}`})):[]),C=()=>{l.items.push({product_id:"",qty:1,unit_price:0})},$=(o,t)=>{if(!d.products)return;const s=d.products.find(i=>i.id===o.product_id);s&&(l.items[t].unit_price=parseFloat(s.selling_price||s.price||0))},c=o=>{if(!o.product_id||!d.products)return null;const t=d.products.find(F=>F.id===o.product_id);if(!t)return null;const s=parseFloat(t.selling_price||t.price||0);if(s===0)return null;const i=parseFloat(o.unit_price||0);if(i===s)return{pct:0,standard:s,color:"text-emerald-500",bg:"bg-emerald-500/10",label:"Standard price"};const r=(i-s)/s*100;return Math.abs(r)<=5?{pct:r,standard:s,color:"text-amber-500",bg:"bg-amber-500/10",label:`${r>0?"+":""}${r.toFixed(1)}%`}:{pct:r,standard:s,color:"text-red-500",bg:"bg-red-500/10",label:`${r>0?"+":""}${r.toFixed(1)}%`}},S=o=>{l.items.splice(o,1)},U=q(()=>l.items.reduce((o,t)=>o+t.qty*t.unit_price,0)),P=()=>{l.put(`/sales/quotations/${d.quotation.id}`)};return(o,t)=>(p(),n(v,null,[u(a(N),{title:`Edit Quotation ${x.quotation.number}`},null,8,["title"]),u(M,{title:"Quotations"},{default:f(()=>[e("div",z,[u(a(h),{href:`/sales/quotations/${x.quotation.id}`,class:"inline-flex items-center gap-2 mb-4 text-sm text-slate-500 dark:text-slate-400 hover:text-slate-900 dark:text-white"},{default:f(()=>[u(a(A),{class:"h-4 w-4"}),t[4]||(t[4]=k(" Back to Detail ",-1))]),_:1},8,["href"]),e("form",{onSubmit:B(P,["prevent"]),class:"space-y-6"},[e("div",L,[e("div",R,[t[10]||(t[10]=e("h3",{class:"text-lg font-semibold text-slate-900 dark:text-white mb-4"},"Edit Quotation Info",-1)),e("div",null,[t[5]||(t[5]=e("label",{class:"block text-sm font-medium text-slate-500 dark:text-slate-400 mb-1"},"Quotation Number",-1)),e("input",{type:"text",value:x.quotation.number,class:"w-full rounded-xl border-0 bg-slate-50 dark:bg-slate-900 dark:bg-slate-800/50 py-2.5 text-slate-500 dark:text-slate-400 cursor-not-allowed",disabled:""},null,8,W)]),e("div",null,[t[7]||(t[7]=e("label",{class:"block text-sm font-medium text-slate-500 dark:text-slate-400 mb-1"},"Customer",-1)),m(e("select",{"onUpdate:modelValue":t[0]||(t[0]=s=>a(l).customer_id=s),class:"w-full rounded-xl border-0 bg-slate-50 dark:bg-slate-800 py-2.5 text-slate-900 dark:text-white focus:ring-2 focus:ring-blue-500/50",required:""},[t[6]||(t[6]=e("option",{value:""},"Select Customer",-1)),(p(!0),n(v,null,w(x.customers,s=>(p(),n("option",{key:s.id,value:s.id},b(s.name),9,G))),128))],512),[[D,a(l).customer_id]])]),e("div",null,[t[8]||(t[8]=e("label",{class:"block text-sm font-medium text-slate-500 dark:text-slate-400 mb-1"},"Quotation Date",-1)),m(e("input",{type:"date","onUpdate:modelValue":t[1]||(t[1]=s=>a(l).quotation_date=s),class:"w-full rounded-xl border-0 bg-slate-50 dark:bg-slate-800 py-2.5 text-slate-900 dark:text-white focus:ring-2 focus:ring-blue-500/50",required:""},null,512),[[g,a(l).quotation_date]])]),e("div",null,[t[9]||(t[9]=e("label",{class:"block text-sm font-medium text-slate-500 dark:text-slate-400 mb-1"},"Valid Until",-1)),m(e("input",{type:"date","onUpdate:modelValue":t[2]||(t[2]=s=>a(l).valid_until=s),class:"w-full rounded-xl border-0 bg-slate-50 dark:bg-slate-800 py-2.5 text-slate-900 dark:text-white focus:ring-2 focus:ring-blue-500/50",required:""},null,512),[[g,a(l).valid_until]])])]),e("div",H,[e("div",J,[t[12]||(t[12]=e("h3",{class:"text-lg font-semibold text-slate-900 dark:text-white"},"Items",-1)),e("button",{type:"button",onClick:C,class:"text-sm font-medium text-blue-400 hover:text-blue-300 flex items-center gap-1"},[u(a(E),{class:"h-4 w-4"}),t[11]||(t[11]=k(" Add Item ",-1))])]),e("div",K,[t[17]||(t[17]=e("div",{class:"hidden sm:grid grid-cols-12 gap-3 px-3 py-2 bg-slate-50 dark:bg-slate-900 dark:bg-slate-800/50 rounded-lg sticky top-0 z-10"},[e("div",{class:"col-span-5 text-[10px] font-bold text-slate-500 uppercase tracking-widest"},"Product"),e("div",{class:"col-span-2 text-[10px] font-bold text-slate-500 uppercase tracking-widest text-center"},"Qty"),e("div",{class:"col-span-2 text-[10px] font-bold text-slate-500 uppercase tracking-widest text-right"},"Unit Price"),e("div",{class:"col-span-2 text-[10px] font-bold text-slate-500 uppercase tracking-widest text-right"},"Subtotal"),e("div",{class:"col-span-1"})],-1)),(p(!0),n(v,null,w(a(l).items,(s,i)=>(p(),n("div",{key:i,class:"grid grid-cols-12 gap-3 items-center bg-slate-50 dark:bg-slate-800/10 p-2 rounded-xl hover:bg-slate-50 dark:hover:bg-slate-800/50 dark:bg-slate-800/30 transition-colors"},[e("div",X,[t[13]||(t[13]=e("label",{class:"sm:hidden block text-[10px] font-bold text-slate-500 uppercase mb-1"},"Product",-1)),u(T,{modelValue:s.product_id,"onUpdate:modelValue":r=>s.product_id=r,options:V.value,placeholder:"Search Product...",onChange:r=>$(s,i)},null,8,["modelValue","onUpdate:modelValue","options","onChange"])]),e("div",Y,[t[14]||(t[14]=e("label",{class:"sm:hidden block text-[10px] font-bold text-slate-500 uppercase mb-1 text-center"},"Qty",-1)),m(e("input",{type:"number","onUpdate:modelValue":r=>s.qty=r,min:"0.0001",step:"any",class:"w-full rounded-lg border-0 bg-slate-50 dark:bg-slate-800 py-2.5 text-xs text-slate-900 dark:text-white focus:ring-1 focus:ring-blue-500 text-center",required:""},null,8,Z),[[g,s.qty]])]),e("div",tt,[t[15]||(t[15]=e("label",{class:"sm:hidden block text-[10px] font-bold text-slate-500 uppercase mb-1 text-right"},"Price",-1)),m(e("input",{type:"number","onUpdate:modelValue":r=>s.unit_price=r,step:"any",class:"w-full rounded-lg border-0 bg-slate-50 dark:bg-slate-800 py-2.5 text-xs text-slate-900 dark:text-white focus:ring-1 focus:ring-blue-500 text-right",required:""},null,8,et),[[g,s.unit_price]]),c(s)?(p(),n("div",st,[e("span",{class:I(["inline-flex items-center rounded-full px-1.5 py-0.5 text-[10px] font-bold",[c(s).color,c(s).bg]])},b(c(s).label),3),c(s).pct!==0?(p(),n("span",{key:0,class:"text-[10px] text-slate-500 truncate",title:"Standard: Rp "+c(s).standard}," Std: "+b(a(y)(c(s).standard)),9,lt)):_("",!0)])):_("",!0)]),e("div",ot,[t[16]||(t[16]=e("label",{class:"sm:hidden block text-[10px] font-bold text-slate-500 uppercase mb-1 text-right"},"Subtotal",-1)),e("div",at,b(a(y)(s.qty*s.unit_price)),1)]),e("div",rt,[a(l).items.length>1?(p(),n("button",{key:0,type:"button",onClick:r=>S(i),class:"p-2 text-slate-600 hover:text-red-400"},[u(a(O),{class:"h-4 w-4"})],8,dt)):_("",!0)])]))),128))]),e("div",it,[e("div",nt,[t[18]||(t[18]=e("p",{class:"text-sm text-slate-500 dark:text-slate-400"},"Total",-1)),e("p",ut,b(a(y)(U.value)),1)])])])]),e("div",pt,[t[19]||(t[19]=e("label",{class:"block text-sm font-medium text-slate-500 dark:text-slate-400 mb-2"},"Notes",-1)),m(e("textarea",{"onUpdate:modelValue":t[3]||(t[3]=s=>a(l).notes=s),rows:"2",class:"w-full rounded-xl border-0 bg-slate-50 dark:bg-slate-800 text-slate-900 dark:text-white focus:ring-2 focus:ring-blue-500/50",placeholder:"Optional notes..."},null,512),[[g,a(l).notes]])]),e("div",ct,[u(a(h),{href:`/sales/quotations/${x.quotation.id}`,class:"px-6 py-2.5 rounded-xl bg-slate-50 dark:bg-slate-800 text-sm font-semibold text-slate-600 dark:text-slate-300 hover:bg-slate-700"},{default:f(()=>[...t[20]||(t[20]=[k("Cancel",-1)])]),_:1},8,["href"]),e("button",{type:"submit",class:"px-6 py-2.5 rounded-xl bg-blue-600 text-sm font-semibold text-white dark:text-white hover:bg-blue-500 shadow-lg shadow-blue-900/20",disabled:a(l).processing},b(a(l).processing?"Saving Changes...":"Save Changes"),9,xt)])],32)])]),_:1})],64))}};export{Mt as default};
