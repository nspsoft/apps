import{f as P,C as B,c as d,a as o,u as a,h as j,w as v,b as e,l as V,d as _,i as E,o as i,e as c,j as p,F as k,g as S,t as m,k as F,v as x,n as K,z as L,B as g,m as z}from"./app-CqAsi7yr.js";import{_ as G}from"./AppLayout-DOsQ-AFe.js";import{a as J}from"./helpers-DnzC1tLX.js";import{_ as h}from"./SearchableSelect-B6aB45wm.js";import{_ as Q}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{r as R}from"./ArrowLeftIcon-Cgkm0phd.js";import{r as C}from"./PlusIcon-CQlipS4B.js";import{r as W}from"./CalendarIcon-Cu2bVccZ.js";import{r as y}from"./TruckIcon-ztmEnE91.js";import{r as H}from"./UserIcon-DZzC9I2D.js";import{r as X}from"./MapPinIcon-tph_a9uB.js";import{r as Y}from"./TrashIcon-DAriRt41.js";/* empty css            */import"./XMarkIcon-DByjCOdW.js";import"./SunIcon-DQ65_t9z.js";import"./WrenchScrewdriverIcon-B7Ina7OH.js";import"./DocumentPlusIcon-BHkLA8SB.js";import"./DocumentTextIcon-B0Kw4avi.js";import"./ShoppingCartIcon-DW8RbP_z.js";import"./SparklesIcon-BUnC9XDM.js";import"./CubeIcon-PJce7BKH.js";import"./ClockIcon-B0Tykvke.js";import"./CheckCircleIcon-wohXqC3A.js";import"./ShieldCheckIcon-DkayqkYq.js";import"./transition-BB7JBRsa.js";const Z={class:"max-w-full px-4 sm:px-6 lg:px-8 mx-auto"},ee={class:"grid grid-cols-1 xl:grid-cols-12 gap-6"},te={class:"xl:col-span-4 space-y-6"},se={class:"glass-card rounded-2xl p-6 border border-slate-200 dark:border-slate-800 shadow-sm"},re={class:"flex items-center gap-2 mb-4"},ae={class:"space-y-4"},le={key:0},oe=["value"],de={class:"relative"},ie={class:"glass-card rounded-2xl p-6 border border-slate-200 dark:border-slate-800 shadow-sm"},ne={class:"flex items-center gap-2 mb-4"},ue={class:"space-y-4"},pe={key:0},me={class:"relative"},ce={class:"glass-card rounded-2xl p-6 border border-slate-200 dark:border-slate-800 shadow-sm"},xe={class:"flex items-center gap-2 mb-4"},be={class:"xl:col-span-8 space-y-6"},_e={class:"glass-card rounded-2xl overflow-hidden border border-slate-200 dark:border-slate-800 shadow-sm min-h-[400px]"},ge={class:"px-6 py-4 border-b border-slate-200 dark:border-slate-800 bg-slate-50 dark:bg-slate-900 dark:bg-slate-800/30 flex justify-between items-center"},he={class:"overflow-x-auto max-h-[600px] overflow-y-auto custom-scrollbar relative"},fe={class:"w-full text-left"},ve={class:"sticky top-0 z-10 bg-slate-50 dark:bg-slate-900 shadow-sm"},ke={key:0,class:"px-6 py-3 text-[10px] font-bold text-slate-500 uppercase text-center tracking-tighter"},ye={class:"divide-y divide-slate-100 dark:divide-slate-800/50"},we={class:"px-6 py-4 min-w-[250px]"},Oe={key:0},Ve={class:"text-sm font-bold text-slate-900 dark:text-white"},Se={class:"text-[10px] text-slate-500 font-mono"},Ce={key:1},De={key:0,class:"px-6 py-4 text-center"},Ue={class:"text-xs font-bold px-2.5 py-1 rounded-lg bg-blue-500/10 text-blue-500"},$e={class:"px-6 py-4 text-center"},Ae=["onUpdate:modelValue","max"],Ne={class:"px-6 py-4 text-xs text-slate-500 font-medium whitespace-nowrap"},Te={class:"px-6 py-4"},qe=["onUpdate:modelValue"],Me={class:"px-6 py-4 text-right"},Ie=["onClick"],Pe={key:0},Be=["colspan"],je={key:0,class:"flex flex-col items-center gap-3"},Ee={key:1,class:"flex flex-col items-center gap-2"},Fe={class:"text-sm text-slate-500 italic"},Ke={class:"flex items-center justify-between glass-card rounded-2xl p-6 border border-slate-200 dark:border-slate-800 shadow-lg"},Le={class:"flex items-center gap-3"},ze=["disabled"],Ge={__name:"Create",props:{salesOrder:Object,salesOrders:Array,vehicles:Array,warehouses:Array,customers:Array,products:Array},setup(w){const n=w,D=g(()=>[{id:"",label:"-- Tanpa Sold Order (Direct DO) --"},...n.salesOrders.map(l=>({id:l.id,label:`${l.so_number} - ${l.customer?.name}`}))]),U=g(()=>n.customers.map(l=>({id:l.id,label:`${l.code?"["+l.code+"] ":""}${l.name}`}))),$=g(()=>n.products.map(l=>({id:l.id,label:`[${l.sku}] ${l.name}`,unit_id:l.unit_id,unit_name:l.unit?.name??"Unit"}))),A=g(()=>[...n.vehicles.map(l=>({id:l.id,label:`${l.license_plate} - ${l.driver_name||"No Driver"}`})),{id:"manual",label:"Input Manual (No Truk Baru)"}]),s=P({sales_order_id:n.salesOrder?.id||"",customer_id:"",warehouse_id:n.salesOrder?.warehouse_id||"",delivery_date:new Date().toISOString().split("T")[0],shipping_address:n.salesOrder?.shipping_address||"",vehicle_id:"",vehicle_number:"",driver_name:"",items:[]}),f=z(!1),O=async()=>{if(s.items=[],!s.sales_order_id){s.customer_id="",s.shipping_address="";return}f.value=!0;try{const t=(await L.get(route("sales.deliveries.so-items",s.sales_order_id))).data;s.customer_id=t.customer_id,s.warehouse_id=t.warehouse_id,s.shipping_address=t.shipping_address,t.items.length===0&&alert("Tidak ada item yang tersisa untuk dikirim pada Sales Order ini."),s.items=t.items.map(r=>({sales_order_item_id:r.sales_order_item_id,product_id:r.product_id,name:r.name,sku:r.sku,qty_ordered:r.qty_ordered,remaining:r.remaining,qty_delivered:r.remaining,unit_id:r.unit_id,unit_name:r.unit_name,notes:""}))}catch(l){console.error("Error fetching SO Items:",l),alert("Gagal memuat item Sales Order.")}finally{f.value=!1}},N=()=>{const l=n.vehicles.find(t=>t.id===s.vehicle_id);l?(s.vehicle_number=l.license_plate,s.driver_name=l.driver_name||""):s.vehicle_id!=="manual"&&(s.vehicle_number="",s.driver_name="")},T=()=>{s.items.push({sales_order_item_id:null,product_id:"",name:"",sku:"",qty_ordered:0,remaining:0,qty_delivered:1,unit_id:"",unit_name:"",notes:""})},q=l=>{s.items.splice(l,1)},M=(l,t)=>{const r=n.products.find(b=>b.id===l.product_id);r&&(l.name=r.name,l.sku=r.sku,l.unit_id=r.unit_id,l.unit_name=r.unit?.name??"Unit")},I=()=>{if(s.sales_order_id&&s.items.length===0){alert("Pilih Sales Order terlebih dahulu.");return}if(!s.sales_order_id&&s.items.length===0){alert("Tambahkan minimal satu item barang.");return}s.post(route("sales.deliveries.store"),{onSuccess:()=>{},onError:l=>{console.error(l)}})};return B(()=>{s.sales_order_id&&O()}),(l,t)=>(i(),d(k,null,[o(a(j),{title:"Create Delivery Order"}),o(G,{title:"Deliveries"},{default:v(()=>[e("div",Z,[o(a(V),{href:l.route("sales.deliveries.index"),class:"inline-flex items-center gap-2 mb-4 text-sm text-slate-500 dark:text-slate-400 hover:text-slate-900 dark:text-white transition-colors"},{default:v(()=>[o(a(R),{class:"h-4 w-4"}),t[8]||(t[8]=_(" Back to List ",-1))]),_:1},8,["href"]),t[30]||(t[30]=e("div",{class:"flex items-center justify-between mb-6"},[e("div",null,[e("h2",{class:"text-2xl font-bold text-slate-900 dark:text-white tracking-tight"},"Create New Delivery"),e("p",{class:"text-sm text-slate-500 mt-1"},"Siapkan Surat Jalan baru untuk pengiriman barang ke customer.")])],-1)),e("form",{onSubmit:E(I,["prevent"]),class:"space-y-6"},[e("div",ee,[e("div",te,[e("div",se,[e("div",re,[o(a(C),{class:"h-5 w-5 text-blue-500"}),t[9]||(t[9]=e("h3",{class:"text-sm font-bold text-slate-900 dark:text-white uppercase tracking-widest"},"Reference & Date",-1))]),e("div",ae,[e("div",null,[t[10]||(t[10]=e("label",{class:"block text-[10px] font-bold text-slate-500 uppercase tracking-tighter mb-1.5"},"Sales Order (Opsional)",-1)),o(h,{modelValue:a(s).sales_order_id,"onUpdate:modelValue":t[0]||(t[0]=r=>a(s).sales_order_id=r),options:D.value,placeholder:"Cari No SO... (Kosongkan utk Direct DO)",onChange:O},null,8,["modelValue","options"])]),a(s).sales_order_id?c("",!0):(i(),d("div",le,[t[11]||(t[11]=e("label",{class:"block text-[10px] font-bold text-slate-500 uppercase tracking-tighter mb-1.5"},"Customer",-1)),o(h,{modelValue:a(s).customer_id,"onUpdate:modelValue":t[1]||(t[1]=r=>a(s).customer_id=r),options:U.value,placeholder:"Pilih Customer...",required:""},null,8,["modelValue","options"])])),e("div",null,[t[13]||(t[13]=e("label",{class:"block text-[10px] font-bold text-slate-500 uppercase tracking-tighter mb-1.5"},"Warehouse Pengirim",-1)),p(e("select",{"onUpdate:modelValue":t[2]||(t[2]=r=>a(s).warehouse_id=r),class:"w-full rounded-xl border-0 bg-slate-50 dark:bg-slate-800 py-2.5 text-sm text-slate-900 dark:text-white focus:ring-2 focus:ring-blue-500/50",required:""},[t[12]||(t[12]=e("option",{value:""},"Pilih Gudang",-1)),(i(!0),d(k,null,S(w.warehouses,r=>(i(),d("option",{key:r.id,value:r.id},m(r.name),9,oe))),128))],512),[[F,a(s).warehouse_id]])]),e("div",null,[t[14]||(t[14]=e("label",{class:"block text-[10px] font-bold text-slate-500 uppercase tracking-tighter mb-1.5"},"Tanggal Kirim",-1)),e("div",de,[o(a(W),{class:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-slate-400"}),p(e("input",{type:"date","onUpdate:modelValue":t[3]||(t[3]=r=>a(s).delivery_date=r),class:"w-full rounded-xl border-0 bg-slate-50 dark:bg-slate-800 py-2.5 pl-10 text-sm text-slate-900 dark:text-white focus:ring-2 focus:ring-blue-500/50 shadow-sm",required:""},null,512),[[x,a(s).delivery_date]])])])])]),e("div",ie,[e("div",ne,[o(a(y),{class:"h-5 w-5 text-emerald-500"}),t[15]||(t[15]=e("h3",{class:"text-sm font-bold text-slate-900 dark:text-white uppercase tracking-widest"},"Fleet & Driver",-1))]),e("div",ue,[e("div",null,[t[16]||(t[16]=e("label",{class:"block text-[10px] font-bold text-slate-500 uppercase tracking-tighter mb-1.5"},"Pilih Armada",-1)),o(h,{modelValue:a(s).vehicle_id,"onUpdate:modelValue":t[4]||(t[4]=r=>a(s).vehicle_id=r),options:A.value,placeholder:"Pilih Truk...",onChange:N},null,8,["modelValue","options"])]),a(s).vehicle_id==="manual"?(i(),d("div",pe,[t[17]||(t[17]=e("label",{class:"block text-[10px] font-bold text-slate-500 uppercase tracking-tighter mb-1.5"},"Input No Truk Manual",-1)),p(e("input",{"onUpdate:modelValue":t[5]||(t[5]=r=>a(s).vehicle_number=r),type:"text",placeholder:"e.g. B 1234 ABC",class:"w-full rounded-xl border-0 bg-slate-50 dark:bg-slate-800 text-sm text-slate-900 dark:text-white focus:ring-2 focus:ring-blue-500/50 shadow-sm",required:""},null,512),[[x,a(s).vehicle_number]])])):c("",!0),e("div",null,[t[18]||(t[18]=e("label",{class:"block text-[10px] font-bold text-slate-500 uppercase tracking-tighter mb-1.5"},"Sopir (Driver)",-1)),e("div",me,[o(a(H),{class:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-slate-400"}),p(e("input",{"onUpdate:modelValue":t[6]||(t[6]=r=>a(s).driver_name=r),type:"text",placeholder:"Nama Sopir...",class:"w-full rounded-xl border-0 bg-slate-50 dark:bg-slate-800 py-2.5 pl-10 text-sm text-slate-900 dark:text-white focus:ring-2 focus:ring-blue-500/50 shadow-sm",required:""},null,512),[[x,a(s).driver_name]])])])])]),e("div",ce,[e("div",xe,[o(a(X),{class:"h-5 w-5 text-amber-500"}),t[19]||(t[19]=e("h3",{class:"text-sm font-bold text-slate-900 dark:text-white uppercase tracking-widest"},"Shipping Address",-1))]),p(e("textarea",{"onUpdate:modelValue":t[7]||(t[7]=r=>a(s).shipping_address=r),rows:"3",class:"w-full rounded-xl border-0 bg-slate-50 dark:bg-slate-800 text-sm text-slate-900 dark:text-white focus:ring-2 focus:ring-blue-500/50 shadow-sm",placeholder:"Alamat lengkap pengiriman..."},null,512),[[x,a(s).shipping_address]])])]),e("div",be,[e("div",_e,[e("div",ge,[t[21]||(t[21]=e("h3",{class:"text-[10px] font-bold text-slate-900 dark:text-white uppercase tracking-widest"},"Items to Ship",-1)),a(s).sales_order_id?c("",!0):(i(),d("button",{key:0,type:"button",onClick:T,class:"text-xs font-bold text-blue-500 hover:text-blue-400 flex items-center gap-1"},[o(a(C),{class:"h-3 w-3"}),t[20]||(t[20]=_(" ADD ITEM ",-1))]))]),e("div",he,[e("table",fe,[e("thead",ve,[e("tr",null,[t[22]||(t[22]=e("th",{class:"px-6 py-3 text-[10px] font-bold text-slate-500 uppercase tracking-tighter"},"Product",-1)),a(s).sales_order_id?(i(),d("th",ke,"Sisa SO")):c("",!0),t[23]||(t[23]=e("th",{class:"px-6 py-3 text-[10px] font-bold text-slate-500 uppercase text-center tracking-tighter"},"Qty Kirim",-1)),t[24]||(t[24]=e("th",{class:"px-6 py-3 text-[10px] font-bold text-slate-500 uppercase tracking-tighter"},"UOM",-1)),t[25]||(t[25]=e("th",{class:"px-6 py-3 text-[10px] font-bold text-slate-500 uppercase tracking-tighter"},"Notes",-1)),t[26]||(t[26]=e("th",{class:"px-6 py-3 text-[10px] font-bold text-slate-500 uppercase text-right tracking-tighter"},null,-1))])]),e("tbody",ye,[(i(!0),d(k,null,S(a(s).items,(r,b)=>(i(),d("tr",{key:b,class:"hover:bg-slate-50 dark:hover:bg-slate-800/20 transition-colors"},[e("td",we,[a(s).sales_order_id?(i(),d("div",Oe,[e("div",Ve,m(r.name),1),e("div",Se,m(r.sku),1)])):(i(),d("div",Ce,[o(h,{modelValue:r.product_id,"onUpdate:modelValue":u=>r.product_id=u,options:$.value,placeholder:"Cari Produk...",onChange:u=>M(r,b),class:"w-full"},null,8,["modelValue","onUpdate:modelValue","options","onChange"])]))]),a(s).sales_order_id?(i(),d("td",De,[e("span",Ue,m(a(J)(r.remaining)),1)])):c("",!0),e("td",$e,[p(e("input",{"onUpdate:modelValue":u=>r.qty_delivered=u,type:"number",step:"any",min:"0.0001",max:a(s).sales_order_id?r.remaining:null,class:K(["w-24 rounded-lg border-0 bg-slate-50 dark:bg-slate-800 text-sm font-bold text-center focus:ring-1 focus:ring-blue-500",{"text-red-500 ring-1 ring-red-500/50 bg-red-500/5":a(s).sales_order_id&&r.qty_delivered>r.remaining}])},null,10,Ae),[[x,r.qty_delivered]])]),e("td",Ne,m(r.unit_name),1),e("td",Te,[p(e("input",{"onUpdate:modelValue":u=>r.notes=u,type:"text",placeholder:"...",class:"w-full rounded-lg border-0 bg-slate-50 dark:bg-slate-800 text-xs focus:ring-1 focus:ring-blue-500"},null,8,qe),[[x,r.notes]])]),e("td",Me,[e("button",{type:"button",onClick:u=>q(b),class:"p-1.5 text-slate-400 hover:text-red-500 transition-colors"},[o(a(Y),{class:"h-4 w-4"})],8,Ie)])]))),128)),a(s).items.length===0?(i(),d("tr",Pe,[e("td",{colspan:a(s).sales_order_id?6:5,class:"px-6 py-12 text-center"},[f.value?(i(),d("div",je,[...t[27]||(t[27]=[e("div",{class:"h-8 w-8 animate-spin rounded-full border-4 border-blue-500 border-t-transparent"},null,-1),e("span",{class:"text-sm text-slate-500"},"Memuat item Sales Order...",-1)])])):(i(),d("div",Ee,[o(a(y),{class:"h-10 w-10 text-slate-200 dark:text-slate-800"}),e("span",Fe,m(a(s).sales_order_id?"Tidak ada item.":"Klik + ADD ITEM untuk menambah barang."),1)]))],8,Be)])):c("",!0)])])])]),e("div",Ke,[t[29]||(t[29]=e("div",{class:"text-xs text-slate-500 italic"}," * Pastikan armada dan Qty kirim sudah sesuai sebelum menyimpan Draft. ",-1)),e("div",Le,[o(a(V),{href:l.route("sales.deliveries.index"),class:"rounded-xl px-6 py-2.5 text-sm font-bold text-slate-600 dark:text-slate-400 hover:bg-slate-50 dark:hover:bg-slate-800 transition-all"},{default:v(()=>[...t[28]||(t[28]=[_(" Batal ",-1)])]),_:1},8,["href"]),e("button",{type:"submit",disabled:a(s).processing||a(s).items.length===0,class:"inline-flex items-center gap-2 rounded-xl bg-gradient-to-r from-blue-600 to-blue-500 px-8 py-2.5 text-sm font-bold text-white shadow-lg shadow-blue-500/20 hover:from-blue-500 hover:to-blue-400 transition-all disabled:opacity-50 active:scale-95"},[o(a(y),{class:"h-5 w-5"}),_(" "+m(a(s).processing?"Menyimpan...":"SIMPAN SURAT JALAN"),1)],8,ze)])])])])],32)])]),_:1})],64))}},gt=Q(Ge,[["__scopeId","data-v-967f2afd"]]);export{gt as default};
