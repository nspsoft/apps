import{f as Q,m as D,q as I,z as j,c as n,a as i,u as l,h as B,w as g,b as e,l as w,d as f,i as O,j as x,o as u,F as k,g as q,t as m,k as T,v as b,n as A,e as v,B as S}from"./app-BAwp6RV6.js";import{_ as M}from"./AppLayout-CsdKrap4.js";import{_ as z}from"./SearchableSelect-DNI0ETiZ.js";import{f as _}from"./helpers-DnzC1tLX.js";import{r as L}from"./ArrowLeftIcon-DQidYrwW.js";import{r as E}from"./PlusIcon-BlGw-Iwa.js";import{r as R}from"./TrashIcon-erV0RHgX.js";/* empty css            */import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./XMarkIcon-V7CKPjvz.js";import"./SunIcon-U6OEtv2_.js";import"./WrenchScrewdriverIcon-BJW7rLOR.js";import"./DocumentPlusIcon-I8drsc-j.js";import"./TruckIcon-MnhfNnJI.js";import"./DocumentTextIcon-1pOJE1-L.js";import"./ShoppingCartIcon-CCYH61-6.js";import"./MapPinIcon-CDcGfMwb.js";import"./SparklesIcon-_ROZm8t1.js";import"./CubeIcon-DhWsQksD.js";import"./ClockIcon-DBJGp2Ga.js";import"./CheckCircleIcon-DLo4mYDO.js";import"./ShieldCheckIcon-C_yXRo_D.js";import"./transition-DqpSpJly.js";const W={class:"max-w-full px-4 sm:px-6 lg:px-8 mx-auto"},G={class:"grid grid-cols-1 xl:grid-cols-12 gap-6"},H={class:"xl:col-span-4 glass-card rounded-2xl p-6 space-y-4"},J=["value"],K=["value"],X={class:"xl:col-span-8 glass-card rounded-2xl p-6"},Y={class:"flex items-center justify-between mb-4"},Z={class:"space-y-2 max-h-[600px] overflow-y-auto custom-scrollbar relative pr-2"},tt={class:"col-span-12 sm:col-span-5"},et={class:"col-span-4 sm:col-span-2"},st=["onUpdate:modelValue"],lt={class:"col-span-4 sm:col-span-2"},ot=["onUpdate:modelValue"],at={key:0,class:"mt-1 flex items-center gap-1"},rt=["title"],dt={class:"col-span-4 sm:col-span-2"},nt={class:"w-full text-xs text-slate-900 dark:text-white font-bold text-right truncate"},it={class:"col-span-12 sm:col-span-1 flex justify-end"},ut=["onClick"],pt={class:"mt-4 pt-4 border-t border-slate-200 dark:border-slate-800 flex justify-end"},ct={class:"text-right"},xt={class:"text-xl font-bold text-slate-900 dark:text-white"},mt={class:"glass-card rounded-2xl p-6"},bt={class:"flex justify-end gap-3"},gt=["disabled"],Mt={__name:"Create",props:{customers:Array,products:Array,quotationNumber:String},setup(y){const p=y,a=Q({customer_id:"",quotation_date:new Date().toISOString().split("T")[0],valid_until:new Date(Date.now()+720*60*60*1e3).toISOString().split("T")[0],notes:"",items:[{product_id:"",qty:1,unit_price:0}]}),h=D(p.quotationNumber);I([()=>a.customer_id,()=>a.quotation_date],async([o,t])=>{try{const s=await j.get(route("sales.quotations.next-number"),{params:{customer_id:o,quotation_date:t}});h.value=s.data.number}catch(s){console.error("Failed to fetch quotation number",s)}});const V=S(()=>p.products?p.products.filter(o=>o&&!o.name.startsWith("SO-")).map(o=>({id:o.id,label:`[${o.sku||"#"+o.id}] ${o.name}`})):[]),C=()=>{a.items.push({product_id:"",qty:1,unit_price:0})},U=(o,t)=>{if(!p.products)return;const s=p.products.find(d=>d.id===o.product_id);s&&(a.items[t].unit_price=parseFloat(s.selling_price||s.price||0))},c=o=>{if(!o.product_id||!p.products)return null;const t=p.products.find(N=>N.id===o.product_id);if(!t)return null;const s=parseFloat(t.selling_price||t.price||0);if(s===0)return null;const d=parseFloat(o.unit_price||0);if(d===s)return{pct:0,standard:s,color:"text-emerald-500",bg:"bg-emerald-500/10",label:"Standard price"};const r=(d-s)/s*100;return Math.abs(r)<=5?{pct:r,standard:s,color:"text-amber-500",bg:"bg-amber-500/10",label:`${r>0?"+":""}${r.toFixed(1)}%`}:{pct:r,standard:s,color:"text-red-500",bg:"bg-red-500/10",label:`${r>0?"+":""}${r.toFixed(1)}%`}},$=o=>{a.items.splice(o,1)},P=S(()=>a.items.reduce((o,t)=>o+t.qty*t.unit_price,0)),F=()=>{a.post("/sales/quotations")};return(o,t)=>(u(),n(k,null,[i(l(B),{title:"Create Quotation"}),i(M,{title:"Quotations"},{default:g(()=>[e("div",W,[i(l(w),{href:"/sales/quotations",class:"inline-flex items-center gap-2 mb-4 text-sm text-slate-500 dark:text-slate-400 hover:text-slate-900 dark:text-white"},{default:g(()=>[i(l(L),{class:"h-4 w-4"}),t[4]||(t[4]=f(" Back to List ",-1))]),_:1}),e("form",{onSubmit:O(F,["prevent"]),class:"space-y-6"},[e("div",G,[e("div",H,[t[10]||(t[10]=e("h3",{class:"text-lg font-semibold text-slate-900 dark:text-white mb-4"},"Quotation Info",-1)),e("div",null,[t[5]||(t[5]=e("label",{class:"block text-sm font-medium text-slate-500 dark:text-slate-400 mb-1"},"Quotation Number",-1)),e("input",{type:"text",value:h.value,class:"w-full rounded-xl border-0 bg-slate-50 dark:bg-slate-900 dark:bg-slate-800/50 py-2.5 text-slate-500 dark:text-slate-400 cursor-not-allowed",disabled:""},null,8,J)]),e("div",null,[t[7]||(t[7]=e("label",{class:"block text-sm font-medium text-slate-500 dark:text-slate-400 mb-1"},"Customer",-1)),x(e("select",{"onUpdate:modelValue":t[0]||(t[0]=s=>l(a).customer_id=s),class:"w-full rounded-xl border-0 bg-slate-50 dark:bg-slate-800 py-2.5 text-slate-900 dark:text-white focus:ring-2 focus:ring-blue-500/50",required:""},[t[6]||(t[6]=e("option",{value:""},"Select Customer",-1)),(u(!0),n(k,null,q(y.customers,s=>(u(),n("option",{key:s.id,value:s.id},m(s.name),9,K))),128))],512),[[T,l(a).customer_id]])]),e("div",null,[t[8]||(t[8]=e("label",{class:"block text-sm font-medium text-slate-500 dark:text-slate-400 mb-1"},"Quotation Date",-1)),x(e("input",{type:"date","onUpdate:modelValue":t[1]||(t[1]=s=>l(a).quotation_date=s),class:"w-full rounded-xl border-0 bg-slate-50 dark:bg-slate-800 py-2.5 text-slate-900 dark:text-white focus:ring-2 focus:ring-blue-500/50",required:""},null,512),[[b,l(a).quotation_date]])]),e("div",null,[t[9]||(t[9]=e("label",{class:"block text-sm font-medium text-slate-500 dark:text-slate-400 mb-1"},"Valid Until",-1)),x(e("input",{type:"date","onUpdate:modelValue":t[2]||(t[2]=s=>l(a).valid_until=s),class:"w-full rounded-xl border-0 bg-slate-50 dark:bg-slate-800 py-2.5 text-slate-900 dark:text-white focus:ring-2 focus:ring-blue-500/50",required:""},null,512),[[b,l(a).valid_until]])])]),e("div",X,[e("div",Y,[t[12]||(t[12]=e("h3",{class:"text-lg font-semibold text-slate-900 dark:text-white"},"Items",-1)),e("button",{type:"button",onClick:C,class:"text-sm font-medium text-blue-400 hover:text-blue-300 flex items-center gap-1"},[i(l(E),{class:"h-4 w-4"}),t[11]||(t[11]=f(" Add Item ",-1))])]),e("div",Z,[t[17]||(t[17]=e("div",{class:"hidden sm:grid grid-cols-12 gap-3 px-3 py-2 bg-slate-50 dark:bg-slate-900 dark:bg-slate-800/50 rounded-lg sticky top-0 z-10"},[e("div",{class:"col-span-5 text-[10px] font-bold text-slate-500 uppercase tracking-widest"},"Product"),e("div",{class:"col-span-2 text-[10px] font-bold text-slate-500 uppercase tracking-widest text-center"},"Qty"),e("div",{class:"col-span-2 text-[10px] font-bold text-slate-500 uppercase tracking-widest text-right"},"Unit Price"),e("div",{class:"col-span-2 text-[10px] font-bold text-slate-500 uppercase tracking-widest text-right"},"Subtotal"),e("div",{class:"col-span-1"})],-1)),(u(!0),n(k,null,q(l(a).items,(s,d)=>(u(),n("div",{key:d,class:"grid grid-cols-12 gap-3 items-center bg-slate-50 dark:bg-slate-800/10 p-2 rounded-xl hover:bg-slate-50 dark:hover:bg-slate-800/50 dark:bg-slate-800/30 transition-colors"},[e("div",tt,[t[13]||(t[13]=e("label",{class:"sm:hidden block text-[10px] font-bold text-slate-500 uppercase mb-1"},"Product",-1)),i(z,{modelValue:s.product_id,"onUpdate:modelValue":r=>s.product_id=r,options:V.value,placeholder:"Search Product...",onChange:r=>U(s,d)},null,8,["modelValue","onUpdate:modelValue","options","onChange"])]),e("div",et,[t[14]||(t[14]=e("label",{class:"sm:hidden block text-[10px] font-bold text-slate-500 uppercase mb-1 text-center"},"Qty",-1)),x(e("input",{type:"number","onUpdate:modelValue":r=>s.qty=r,min:"0.0001",step:"any",class:"w-full rounded-lg border-0 bg-slate-50 dark:bg-slate-800 py-2.5 text-xs text-slate-900 dark:text-white focus:ring-1 focus:ring-blue-500 text-center",required:""},null,8,st),[[b,s.qty]])]),e("div",lt,[t[15]||(t[15]=e("label",{class:"sm:hidden block text-[10px] font-bold text-slate-500 uppercase mb-1 text-right"},"Price",-1)),x(e("input",{type:"number","onUpdate:modelValue":r=>s.unit_price=r,step:"any",class:"w-full rounded-lg border-0 bg-slate-50 dark:bg-slate-800 py-2.5 text-xs text-slate-900 dark:text-white focus:ring-1 focus:ring-blue-500 text-right",required:""},null,8,ot),[[b,s.unit_price]]),c(s)?(u(),n("div",at,[e("span",{class:A(["inline-flex items-center rounded-full px-1.5 py-0.5 text-[10px] font-bold",[c(s).color,c(s).bg]])},m(c(s).label),3),c(s).pct!==0?(u(),n("span",{key:0,class:"text-[10px] text-slate-500 truncate",title:"Standard: Rp "+c(s).standard}," Std: "+m(l(_)(c(s).standard)),9,rt)):v("",!0)])):v("",!0)]),e("div",dt,[t[16]||(t[16]=e("label",{class:"sm:hidden block text-[10px] font-bold text-slate-500 uppercase mb-1 text-right"},"Subtotal",-1)),e("div",nt,m(l(_)(s.qty*s.unit_price)),1)]),e("div",it,[l(a).items.length>1?(u(),n("button",{key:0,type:"button",onClick:r=>$(d),class:"p-2 text-slate-600 hover:text-red-400"},[i(l(R),{class:"h-4 w-4"})],8,ut)):v("",!0)])]))),128))]),e("div",pt,[e("div",ct,[t[18]||(t[18]=e("p",{class:"text-sm text-slate-500 dark:text-slate-400"},"Total",-1)),e("p",xt,m(l(_)(P.value)),1)])])])]),e("div",mt,[t[19]||(t[19]=e("label",{class:"block text-sm font-medium text-slate-500 dark:text-slate-400 mb-2"},"Notes",-1)),x(e("textarea",{"onUpdate:modelValue":t[3]||(t[3]=s=>l(a).notes=s),rows:"2",class:"w-full rounded-xl border-0 bg-slate-50 dark:bg-slate-800 text-slate-900 dark:text-white focus:ring-2 focus:ring-blue-500/50",placeholder:"Optional notes..."},null,512),[[b,l(a).notes]])]),e("div",bt,[i(l(w),{href:"/sales/quotations",class:"px-6 py-2.5 rounded-xl bg-slate-50 dark:bg-slate-800 text-sm font-semibold text-slate-600 dark:text-slate-300 hover:bg-slate-700"},{default:g(()=>[...t[20]||(t[20]=[f("Cancel",-1)])]),_:1}),e("button",{type:"submit",class:"px-6 py-2.5 rounded-xl bg-blue-600 text-sm font-semibold text-white dark:text-white hover:bg-blue-500 shadow-lg shadow-blue-900/20",disabled:l(a).processing},m(l(a).processing?"Saving...":"Save Quotation"),9,gt)])],32)])]),_:1})],64))}};export{Mt as default};
