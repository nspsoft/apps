import{x as k,w as J,o as l,c as a,b as e,n as g,a as n,u as o,e as u,i as A,t as r,d as x,F,g as $,T as K,m as f,B as W,z as U,s as Q}from"./app-CqAsi7yr.js";/* empty css                                                                      */import{_ as X}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{r as w}from"./SparklesIcon-BUnC9XDM.js";import{r as Y}from"./XMarkIcon-DByjCOdW.js";import{r as Z}from"./EyeIcon-jz-7eWpQ.js";import{b as ee,a as z,c as te,r as se}from"./WrenchScrewdriverIcon-B7Ina7OH.js";import{r as P}from"./DocumentIcon-D9pxRjDR.js";import{r as le}from"./CloudArrowUpIcon-clrj5zP9.js";import{r as ae}from"./ExclamationTriangleIcon-CdX0jrE6.js";import{r as C}from"./CheckCircleIcon-wohXqC3A.js";import{r as re}from"./ShoppingCartIcon-DW8RbP_z.js";import{r as oe}from"./QuestionMarkCircleIcon-LMwUsPTV.js";/* empty css            */const de={key:0,class:"fixed inset-0 z-50 overflow-y-auto"},ne={class:"flex min-h-full items-center justify-center p-4"},ie={class:"p-6 border-b border-slate-100 dark:border-slate-800 flex items-center justify-between bg-slate-50/50 dark:bg-slate-800/50"},ce={class:"flex items-center gap-3"},ue={class:"p-2.5 rounded-2xl bg-amber-500/10 text-amber-500"},xe={key:0,class:"w-1/2 flex flex-col"},pe={class:"flex items-center justify-between mb-3"},be={class:"flex items-center gap-2"},me=["href"],fe={class:"flex-1 rounded-2xl border border-slate-200 dark:border-slate-700 overflow-hidden bg-slate-100 dark:bg-slate-800"},ve=["src"],ge=["src"],_e={key:2,class:"w-full h-full min-h-[500px] flex items-center justify-center text-slate-400"},he={class:"text-center"},ye={key:0,class:"flex flex-col items-center py-4"},ke={class:"p-4 rounded-full bg-slate-50 dark:bg-slate-800 group-hover:bg-blue-500/10 transition-colors"},we={class:"text-center"},Pe={class:"text-sm font-semibold text-slate-700 dark:text-slate-200"},Ce={key:0,class:"mt-4 w-full p-4 rounded-xl bg-red-500/10 border border-red-500/20 flex items-center gap-3 text-red-500"},Oe={class:"text-sm font-medium"},Ie=["disabled"],Se={key:1,class:"flex flex-col items-center py-12"},je={class:"relative"},De={class:"absolute inset-0 flex items-center justify-center"},Ae={class:"mt-10 w-full max-w-xs space-y-3"},Fe={class:"flex items-center gap-3"},$e={class:"flex items-center gap-3"},Ue={key:2,class:"space-y-4"},ze={class:"bg-emerald-500/10 border border-emerald-500/20 p-3 rounded-2xl flex items-center gap-3 text-emerald-500"},Be={class:"text-sm font-bold"},Ne={class:"grid grid-cols-2 gap-4"},Le={class:"p-4 rounded-2xl bg-slate-50 dark:bg-slate-800/50 border border-slate-100 dark:border-slate-800"},Me={class:"mt-1 font-bold text-slate-900 dark:text-white"},Re={class:"p-4 rounded-2xl bg-slate-50 dark:bg-slate-800/50 border border-slate-100 dark:border-slate-800"},Te={class:"mt-1 font-bold text-slate-900 dark:text-white"},qe={key:0,class:"ml-2 text-[10px] bg-emerald-500 text-white px-1.5 py-0.5 rounded-md"},Ge={class:"border border-slate-100 dark:border-slate-800 rounded-2xl overflow-hidden overflow-x-auto"},Ee={class:"w-full text-left text-sm"},Ve={class:"divide-y divide-slate-100 dark:divide-slate-800"},He={class:"px-3 py-3 text-xs max-w-[150px]"},Je={class:"px-3 py-3 font-bold capitalize whitespace-nowrap"},Ke={class:"px-3 py-3"},We={key:0,class:"flex flex-col"},Qe={class:"text-[10px] font-bold text-emerald-500"},Xe={class:"text-[10px] text-slate-500 truncate max-w-[120px]"},Ye={key:1,class:"text-[10px] font-bold text-red-500"},Ze={class:"px-3 py-3"},et={key:0,class:"space-y-1"},tt={class:"flex items-center gap-2"},st={class:"flex items-center gap-2"},lt={class:"text-[11px] font-bold text-emerald-600"},at={key:0,class:"flex items-center gap-1 mt-1"},rt={key:1,class:"text-[10px] text-slate-400"},ot={class:"flex gap-4 pt-4"},dt=["disabled"],nt={key:3,class:"space-y-4"},it={class:"flex items-center justify-between"},ct={class:"flex gap-2"},ut={key:0,class:"px-2 py-1 text-xs font-bold bg-emerald-500/20 text-emerald-600 rounded-full"},xt={key:1,class:"px-2 py-1 text-xs font-bold bg-amber-500/20 text-amber-600 rounded-full"},pt={key:2,class:"px-2 py-1 text-xs font-bold bg-red-500/20 text-red-600 rounded-full"},bt={class:"space-y-4 max-h-80 overflow-y-auto pr-2"},mt={class:"flex items-start justify-between mb-3"},ft={class:"font-bold text-slate-900 dark:text-white text-sm"},vt={key:0,class:"text-xs text-slate-500 font-mono"},gt={class:"grid grid-cols-2 md:grid-cols-4 gap-3 mb-3"},_t={class:"text-center p-2 rounded-xl bg-white/50 dark:bg-slate-900/50"},ht={class:"text-lg font-bold text-slate-900 dark:text-white"},yt={class:"text-center p-2 rounded-xl bg-white/50 dark:bg-slate-900/50"},kt={class:"text-lg font-bold text-blue-600"},wt={class:"text-center p-2 rounded-xl bg-white/50 dark:bg-slate-900/50"},Pt={class:"text-lg font-bold text-cyan-600"},Ct={class:"text-center p-2 rounded-xl bg-white/50 dark:bg-slate-900/50"},Ot={class:"text-lg font-bold text-purple-600"},It={class:"flex items-center justify-between p-3 rounded-xl bg-white/30 dark:bg-slate-900/30"},St={class:"flex items-center gap-2"},jt={class:"flex items-center gap-2"},Dt={key:0,class:"text-xs text-emerald-600 font-semibold flex items-center gap-1"},At={key:1,class:"text-xs bg-purple-500/20 text-purple-600 px-2 py-1 rounded-lg font-bold flex items-center gap-1"},Ft={key:2,class:"text-xs bg-blue-500/20 text-blue-600 px-2 py-1 rounded-lg font-bold flex items-center gap-1"},$t={key:3,class:"text-xs text-slate-500 italic"},Ut={class:"flex gap-4 pt-4"},zt={class:"p-6 bg-slate-50 dark:bg-slate-800/30 border-t border-slate-100 dark:border-slate-800"},Bt={class:"flex items-center justify-between"},Nt={href:"/guide/ai-po-extractor.html",target:"_blank",class:"inline-flex items-center gap-1.5 text-xs text-blue-600 hover:text-blue-700 dark:text-blue-400 dark:hover:text-blue-300 font-semibold transition-colors"},Lt={__name:"POImportModal",props:{show:Boolean,customers:Array},emits:["close"],setup(B,{emit:N}){const L=N,p=f(null),O=f(null),c=f(null),h=f(!1),_=f(!1),v=f(null),b=f(null),m=f(null),d=f(1),I=W(()=>{if(!p.value)return null;const i=p.value.type;return i==="application/pdf"?"pdf":i.startsWith("image/")?"image":"unknown"}),M=()=>{p.value&&(c.value&&URL.revokeObjectURL(c.value),c.value=URL.createObjectURL(p.value))},R=()=>{c.value&&(URL.revokeObjectURL(c.value),c.value=null)},S=i=>{const t=i.target.files?.[0]||i.dataTransfer?.files?.[0];t&&(p.value=t,v.value=null,M())},T=()=>{O.value.click()},q=async()=>{if(!p.value)return;h.value=!0,v.value=null,d.value=2;const i=new FormData;i.append("file",p.value);try{const t=await U.post("/sales/orders/ai-extract",i,{headers:{"Content-Type":"multipart/form-data"}});t.data.success&&(b.value=t.data.data,d.value=3)}catch(t){d.value=1,v.value=t.response?.data?.message||"Failed to process PO. Please try again."}finally{h.value=!1}},j=()=>{Q.post("/sales/orders/create-from-ai",{data:b.value})},G=()=>{R(),p.value=null,v.value=null,b.value=null,m.value=null,d.value=1},E=async()=>{if(b.value?.items){_.value=!0,v.value=null;try{const i=b.value.items.map(s=>({product_id:s.matched_product?.id||null,product_name:s.description,qty:s.qty})),t=await U.post("/sales/orders/analyze-fulfillment",{items:i});t.data.success&&(m.value=t.data,d.value=4)}catch(i){v.value=i.response?.data?.message||"Failed to analyze fulfillment. Please try again."}finally{_.value=!1}}},V=i=>{switch(i){case"green":return"bg-emerald-500";case"yellow":return"bg-amber-500";case"red":return"bg-red-500";default:return"bg-slate-500"}},H=i=>{switch(i){case"green":return"bg-emerald-500/10 border-emerald-500/20";case"yellow":return"bg-amber-500/10 border-amber-500/20";case"red":return"bg-red-500/10 border-red-500/20";default:return"bg-slate-500/10 border-slate-500/20"}},D=()=>{G(),L("close")};return(i,t)=>(l(),k(K,{"enter-active-class":"transition ease-out duration-300","enter-from-class":"opacity-0","enter-to-class":"opacity-100","leave-active-class":"transition ease-in duration-200","leave-from-class":"opacity-100","leave-to-class":"opacity-0"},{default:J(()=>[B.show?(l(),a("div",de,[e("div",{class:"fixed inset-0 bg-slate-900/60 backdrop-blur-sm",onClick:D}),e("div",ne,[e("div",{class:g(["relative w-full bg-white dark:bg-slate-900 rounded-3xl shadow-2xl overflow-hidden border border-slate-200 dark:border-slate-800 transition-all duration-300",(d.value===3||d.value===4)&&c.value?"max-w-6xl":"max-w-2xl"])},[e("div",ie,[e("div",ce,[e("div",ue,[n(o(w),{class:"h-6 w-6"})]),t[3]||(t[3]=e("div",null,[e("h3",{class:"text-lg font-bold text-slate-900 dark:text-white"},"AI Purchase Order Extractor"),e("p",{class:"text-xs text-slate-500 mt-0.5"},"Powered by Gemini AI")],-1))]),e("button",{onClick:D,class:"p-2 rounded-xl text-slate-400 hover:text-slate-600 dark:hover:text-slate-200 hover:bg-slate-100 dark:hover:bg-slate-800 transition-colors"},[n(o(Y),{class:"h-6 w-6"})])]),e("div",{class:g(["p-6",(d.value===3||d.value===4)&&c.value?"flex gap-6":""])},[(d.value===3||d.value===4)&&c.value?(l(),a("div",xe,[e("div",pe,[e("div",be,[n(o(Z),{class:"h-4 w-4 text-slate-500"}),t[4]||(t[4]=e("span",{class:"text-xs font-bold text-slate-500 uppercase tracking-wider"},"Original Document",-1))]),e("a",{href:c.value,target:"_blank",class:"p-1.5 rounded-lg text-slate-400 hover:text-slate-600 hover:bg-slate-100 dark:hover:bg-slate-800 transition-colors",title:"Open in new tab"},[n(o(ee),{class:"h-4 w-4"})],8,me)]),e("div",fe,[I.value==="pdf"?(l(),a("iframe",{key:0,src:c.value,class:"w-full h-full min-h-[500px]",title:"PO Document Preview"},null,8,ve)):I.value==="image"?(l(),a("img",{key:1,src:c.value,class:"w-full h-full object-contain min-h-[500px]",alt:"PO Document Preview"},null,8,ge)):(l(),a("div",_e,[e("div",he,[n(o(P),{class:"h-12 w-12 mx-auto mb-2"}),t[5]||(t[5]=e("p",{class:"text-sm"},"Preview not available",-1))])]))])])):u("",!0),e("div",{class:g([(d.value===3||d.value===4)&&c.value?"w-1/2":"w-full"])},[d.value===1?(l(),a("div",ye,[e("div",{onClick:T,onDragover:t[0]||(t[0]=A(()=>{},["prevent"])),onDrop:A(S,["prevent"]),class:"w-full h-48 border-2 border-dashed border-slate-200 dark:border-slate-800 rounded-3xl flex flex-col items-center justify-center gap-4 cursor-pointer hover:border-blue-500/50 hover:bg-blue-500/5 transition-all group"},[e("div",ke,[n(o(le),{class:"h-10 w-10 text-slate-400 group-hover:text-blue-500 transition-colors"})]),e("div",we,[e("p",Pe,r(p.value?p.value.name:"Click to upload or drag & drop"),1),t[6]||(t[6]=e("p",{class:"text-xs text-slate-500 mt-1"},"PDF or Image (Max 5MB)",-1))]),e("input",{ref_key:"fileInput",ref:O,type:"file",class:"hidden",accept:".pdf,image/*",onChange:S},null,544)],32),v.value?(l(),a("div",Ce,[n(o(ae),{class:"h-5 w-5 shrink-0"}),e("span",Oe,r(v.value),1)])):u("",!0),e("button",{onClick:q,disabled:!p.value||h.value,class:"mt-8 w-full py-3 px-6 rounded-2xl bg-gradient-to-r from-blue-600 to-indigo-600 text-white font-bold shadow-lg shadow-blue-500/25 dark:shadow-blue-500/10 hover:shadow-xl transition-all disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2"},[n(o(w),{class:"h-5 w-5"}),t[7]||(t[7]=x(" Start AI Extraction ",-1))],8,Ie)])):u("",!0),d.value===2?(l(),a("div",Se,[e("div",je,[t[8]||(t[8]=e("div",{class:"w-24 h-24 rounded-full border-4 border-slate-100 dark:border-slate-800 border-t-blue-500 animate-spin"},null,-1)),e("div",De,[n(o(w),{class:"h-8 w-8 text-amber-500 animate-pulse"})])]),t[12]||(t[12]=e("h4",{class:"mt-8 text-lg font-bold text-slate-900 dark:text-white"},"AI is reading your document...",-1)),t[13]||(t[13]=e("p",{class:"mt-2 text-sm text-slate-500 text-center max-w-xs"}," Gemini is identifying products, quantities, and customer details. Please wait a moment. ",-1)),e("div",Ae,[e("div",Fe,[n(o(C),{class:"h-5 w-5 text-emerald-500"}),t[9]||(t[9]=e("span",{class:"text-xs font-semibold text-slate-400"},"File Uploaded",-1))]),e("div",$e,[n(o(z),{class:"h-5 w-5 text-blue-500 animate-spin"}),t[10]||(t[10]=e("span",{class:"text-xs font-semibold text-slate-700 dark:text-slate-200"},"Processing Multimodal Vision",-1))]),t[11]||(t[11]=e("div",{class:"flex items-center gap-3"},[e("div",{class:"h-5 w-5 rounded-full border-2 border-slate-200 dark:border-slate-800"}),e("span",{class:"text-xs font-semibold text-slate-400"},"Synchronizing with JICOS Catalog")],-1))])])):u("",!0),d.value===3?(l(),a("div",Ue,[e("div",ze,[n(o(C),{class:"h-5 w-5"}),e("div",Be,"Extraction Successful! AI found "+r(b.value.items?.length)+" items.",1)]),e("div",Ne,[e("div",Le,[t[14]||(t[14]=e("span",{class:"text-[10px] font-bold text-slate-400 uppercase tracking-widest"},"Customer PO Number",-1)),e("div",Me,r(b.value.po_number||"Not found"),1)]),e("div",Re,[t[15]||(t[15]=e("span",{class:"text-[10px] font-bold text-slate-400 uppercase tracking-widest"},"Customer Name",-1)),e("div",Te,[x(r(b.value.matched_customer_name||b.value.customer_name||"Not found")+" ",1),b.value.matched_customer_id?(l(),a("span",qe,"MATCHED")):u("",!0)])])]),e("div",Ge,[e("table",Ee,[t[19]||(t[19]=e("thead",{class:"bg-slate-50 dark:bg-slate-800/80"},[e("tr",null,[e("th",{class:"px-3 py-3 font-bold text-slate-500 uppercase text-[10px]"},"Description"),e("th",{class:"px-3 py-3 font-bold text-slate-500 uppercase text-[10px]"},"Qty"),e("th",{class:"px-3 py-3 font-bold text-slate-500 uppercase text-[10px]"},"JICOS Match"),e("th",{class:"px-3 py-3 font-bold text-slate-500 uppercase text-[10px]"},"Price Comparison")])],-1)),e("tbody",Ve,[(l(!0),a(F,null,$(b.value.items,(s,y)=>(l(),a("tr",{key:y,class:"dark:text-slate-300"},[e("td",He,r(s.description),1),e("td",Je,r(s.qty)+" "+r(s.unit),1),e("td",Ke,[s.matched_product_id?(l(),a("div",We,[e("span",Qe,r(s.matched_sku),1),e("span",Xe,r(s.matched_product_name),1)])):(l(),a("div",Ye,"NO MATCH"))]),e("td",Ze,[s.matched_product_id?(l(),a("div",et,[e("div",tt,[t[16]||(t[16]=e("span",{class:"text-[9px] text-slate-400 w-8"},"PO:",-1)),e("span",{class:g(["text-[11px] font-semibold",s.price_mismatch?"text-amber-500":"text-slate-600 dark:text-slate-300"])},r(s.po_price?"Rp "+Number(s.po_price).toLocaleString("id-ID"):"-"),3)]),e("div",st,[t[17]||(t[17]=e("span",{class:"text-[9px] text-slate-400 w-8"},"DB:",-1)),e("span",lt," Rp "+r(Number(s.db_price||0).toLocaleString("id-ID")),1)]),s.price_mismatch?(l(),a("div",at,[...t[18]||(t[18]=[e("span",{class:"text-[9px] bg-amber-500/20 text-amber-600 px-1.5 py-0.5 rounded font-bold"},"âš  SELISIH",-1)])])):u("",!0)])):(l(),a("div",rt,"-"))])]))),128))])])]),t[21]||(t[21]=e("div",{class:"mt-3 p-3 rounded-xl bg-blue-500/10 border border-blue-500/20 text-xs text-blue-600 dark:text-blue-400"},[x(" ðŸ’¡ "),e("strong",null,"Catatan:"),x(" Harga yang digunakan adalah "),e("strong",null,"Selling Price dari database"),x('. Jika ada selisih dengan harga di PO, Anda dapat mengedit langsung di form Sales Order setelah klik "Generate Draft SO". ')],-1)),e("div",ot,[e("button",{onClick:t[1]||(t[1]=s=>d.value=1),class:"py-3 px-6 rounded-2xl bg-slate-100 dark:bg-slate-800 text-slate-600 dark:text-slate-300 font-bold hover:bg-slate-200 transition-all"}," Try Again "),e("button",{onClick:E,disabled:_.value,class:"flex-1 py-3 px-6 rounded-2xl bg-amber-500 text-white font-bold shadow-lg shadow-amber-500/25 hover:bg-amber-400 transition-all flex items-center justify-center gap-2 disabled:opacity-50"},[_.value?(l(),k(o(z),{key:1,class:"h-5 w-5 animate-spin"})):(l(),k(o(te),{key:0,class:"h-5 w-5"})),x(" "+r(_.value?"Analyzing...":"Analyze Fulfillment"),1)],8,dt),e("button",{onClick:j,class:"flex-1 py-3 px-6 rounded-2xl bg-blue-600 text-white font-bold shadow-lg shadow-blue-500/25 hover:bg-blue-500 transition-all flex items-center justify-center gap-2"},[n(o(P),{class:"h-5 w-5"}),t[20]||(t[20]=x(" Generate Draft SO ",-1))])])])):u("",!0),d.value===4?(l(),a("div",nt,[e("div",it,[t[22]||(t[22]=e("div",null,[e("h3",{class:"text-lg font-bold text-slate-900 dark:text-white"},"Fulfillment Analysis"),e("p",{class:"text-xs text-slate-500 dark:text-slate-400"},"Stock check & recommendations")],-1)),e("div",ct,[m.value?.summary?.items_ok>0?(l(),a("span",ut,r(m.value.summary.items_ok)+" OK ",1)):u("",!0),m.value?.summary?.items_warning>0?(l(),a("span",xt,r(m.value.summary.items_warning)+" Warning ",1)):u("",!0),m.value?.summary?.items_critical>0?(l(),a("span",pt,r(m.value.summary.items_critical)+" Critical ",1)):u("",!0)])]),e("div",bt,[(l(!0),a(F,null,$(m.value?.items,(s,y)=>(l(),a("div",{key:y,class:g(["p-4 rounded-2xl border",H(s.priority)])},[e("div",mt,[e("div",null,[e("h4",ft,r(s.product_name),1),s.product_sku?(l(),a("p",vt,r(s.product_sku),1)):u("",!0)]),e("div",{class:g(["w-3 h-3 rounded-full",V(s.priority)])},null,2)]),e("div",gt,[e("div",_t,[e("p",ht,r(s.required_qty),1),t[23]||(t[23]=e("p",{class:"text-[10px] text-slate-500 uppercase tracking-wider"},"Required",-1))]),e("div",yt,[e("p",kt,r(s.available_stock||0),1),t[24]||(t[24]=e("p",{class:"text-[10px] text-slate-500 uppercase tracking-wider"},"Available",-1))]),e("div",wt,[e("p",Pt,r(s.incoming_po||0),1),t[25]||(t[25]=e("p",{class:"text-[10px] text-slate-500 uppercase tracking-wider"},"Incoming PO",-1))]),e("div",Ct,[e("p",Ot,r(s.in_production||0),1),t[26]||(t[26]=e("p",{class:"text-[10px] text-slate-500 uppercase tracking-wider"},"In Production",-1))])]),e("div",It,[e("div",St,[e("span",{class:g(["px-2 py-1 rounded-lg text-xs font-bold",s.gap>=0?"bg-emerald-500/20 text-emerald-600":"bg-red-500/20 text-red-600"])}," Gap: "+r(s.gap>=0?"+":"")+r(s.gap),3)]),e("div",jt,[s.recommendation?.action==="fulfill_from_stock"?(l(),a("span",Dt,[n(o(C),{class:"h-4 w-4"}),t[27]||(t[27]=x(" Stock OK ",-1))])):s.recommendation?.action==="create_work_order"?(l(),a("span",At,[n(o(se),{class:"h-4 w-4"}),x(" "+r(s.recommendation.message),1)])):s.recommendation?.action==="create_purchase_order"?(l(),a("span",Ft,[n(o(re),{class:"h-4 w-4"}),x(" "+r(s.recommendation.message),1)])):(l(),a("span",$t,r(s.recommendation?.message||"Match product first"),1))])])],2))),128))]),e("div",Ut,[e("button",{onClick:t[2]||(t[2]=s=>d.value=3),class:"py-3 px-6 rounded-2xl bg-slate-100 dark:bg-slate-800 text-slate-600 dark:text-slate-300 font-bold hover:bg-slate-200 transition-all"}," Back "),e("button",{onClick:j,class:"flex-1 py-3 px-6 rounded-2xl bg-blue-600 text-white font-bold shadow-lg shadow-blue-500/25 hover:bg-blue-500 transition-all flex items-center justify-center gap-2"},[n(o(P),{class:"h-5 w-5"}),t[28]||(t[28]=x(" Proceed to Generate SO ",-1))])])])):u("",!0)],2)],2),e("div",zt,[e("div",Bt,[e("a",Nt,[n(o(oe),{class:"h-4 w-4"}),t[29]||(t[29]=x(" User Guide ",-1))]),t[30]||(t[30]=e("p",{class:"text-[10px] text-slate-500 dark:text-slate-400 font-medium"}," Tip: Best results come from high-resolution images or clear PDF documents. ",-1))])])],2)])])):u("",!0)]),_:1}))}},Zt=X(Lt,[["__scopeId","data-v-6cd57e7d"]]);export{Zt as default};
