import{f as P,c as d,a as u,u as l,h as F,w as _,b as t,l as w,d as h,i as M,j as p,o as n,F as x,g,t as c,k as v,v as f,n as $,e as A,z as R,B as j}from"./app-zJsw02vx.js";import{_ as B}from"./AppLayout-D4BpQC0B.js";import{_ as I}from"./SearchableSelect-LCAujdJb.js";import{r as N}from"./ArrowLeftIcon-BN2kMKgd.js";import{r as D}from"./PlusIcon-Cmb2acl8.js";import{r as T}from"./TrashIcon-XrsR0Tep.js";/* empty css            */import"./XMarkIcon-DfeFp9AX.js";import"./SunIcon-zdIWEs-R.js";import"./WrenchScrewdriverIcon-D_aAqD7I.js";import"./DocumentPlusIcon-pDB4SSRv.js";import"./TruckIcon-DHPnLxIR.js";import"./DocumentTextIcon-Bgyb8RGC.js";import"./ShoppingCartIcon-BP7AbJ38.js";import"./MapPinIcon-CsgHsumu.js";import"./SparklesIcon-Otaa2E01.js";import"./CubeIcon-CZD74TpM.js";import"./ClockIcon-C-qVshqO.js";import"./CheckCircleIcon-BYy8QWv7.js";import"./ShieldCheckIcon-6jFN3elY.js";import"./transition-C3fewcfM.js";const z={class:"max-w-full px-4 sm:px-6 lg:px-8 mx-auto"},W={class:"grid grid-cols-1 xl:grid-cols-12 gap-6"},E={class:"xl:col-span-4 glass-card rounded-2xl p-6 space-y-4"},G=["value"],L=["value"],Q=["value"],H={class:"xl:col-span-8 glass-card rounded-2xl p-6"},J={class:"flex items-center justify-between mb-4"},K={class:"space-y-3 max-h-[600px] overflow-y-auto custom-scrollbar pr-2 relative"},X={class:"col-span-12 sm:col-span-5"},Y={class:"col-span-4 sm:col-span-2"},Z=["onUpdate:modelValue"],ee={key:0,class:"text-[10px] text-red-500 mt-1 text-right"},te={key:1,class:"text-[10px] text-amber-500 mt-1 text-right"},se={class:"col-span-4 sm:col-span-3"},re=["onUpdate:modelValue","onChange"],oe={class:"col-span-4 sm:col-span-2 flex justify-end"},le=["onClick"],ae={class:"glass-card rounded-2xl p-6"},de={class:"flex justify-end gap-3"},ne=["disabled"],Pe={__name:"Create",props:{purchaseOrder:Object,purchaseOrders:Array,suppliers:Array,warehouses:Array,products:Array},setup(b){const m=b,q=j(()=>m.products.map(r=>({id:r.id,label:`[${r.code||r.sku||"-"}] ${r.name}`,...r}))),o=P({purchase_order_id:m.purchaseOrder?.id||null,supplier_id:m.purchaseOrder?.supplier_id||"",warehouse_id:m.purchaseOrder?.warehouse_id||"",receipt_date:new Date().toISOString().split("T")[0],notes:"",items:m.purchaseOrder?.items.map(r=>({product_id:r.product_id,name:r.product?.name,qty_received:r.qty-((r.qty_received||0)-(r.qty_returned||0)),unit_cost:Math.round(parseFloat(r.unit_price||0))}))||[]}),O=()=>{o.items.push({product_id:"",name:"",qty_received:1,unit_cost:0})},C=r=>{o.items.splice(r,1)},V=(r,e)=>{o.items[r].product_id=e.id,o.items[r].name=e.name},S=async r=>{if(r)try{const s=(await R.get(route("purchasing.receipts.po-items",r))).data;o.supplier_id=s.supplier_id,o.warehouse_id=s.warehouse_id,o.items=s.items.map(a=>({po_item_id:a.po_item_id,product_id:a.product_id,name:a.name,qty_ordered:a.qty_ordered,remaining_qty:a.remaining_qty,qty_received:a.remaining_qty,unit_cost:Math.round(parseFloat(a.unit_cost||0))}))}catch(e){console.error("Error fetching PO items:",e),alert("Failed to fetch PO items. Please try again.")}},y=r=>{if(!r.qty_ordered)return!1;const s=Math.round(r.remaining_qty*1.1);return r.qty_received>r.remaining_qty+1e-4&&r.qty_received<=s+1e-4},k=r=>{if(!r.qty_ordered)return!1;const s=Math.round(r.remaining_qty*1.1);return r.qty_received>s+1e-4},U=()=>{o.post("/purchasing/receipts")};return(r,e)=>(n(),d(x,null,[u(l(F),{title:"Create Goods Receipt"}),u(B,{title:"Goods Receipts"},{default:_(()=>[t("div",z,[u(l(w),{href:"/purchasing/receipts",class:"inline-flex items-center gap-2 mb-4 text-sm text-slate-500 dark:text-slate-400 hover:text-slate-900 dark:text-white"},{default:_(()=>[u(l(N),{class:"h-4 w-4"}),e[6]||(e[6]=h(" Back to List ",-1))]),_:1}),t("form",{onSubmit:M(U,["prevent"]),class:"space-y-6"},[t("div",W,[t("div",E,[e[14]||(e[14]=t("h3",{class:"text-lg font-semibold text-slate-900 dark:text-white mb-4"},"Receipt Info",-1)),t("div",null,[e[8]||(e[8]=t("label",{class:"block text-sm font-medium text-slate-500 dark:text-slate-400 mb-1"},"Purchase Order (Optional)",-1)),p(t("select",{"onUpdate:modelValue":e[0]||(e[0]=s=>l(o).purchase_order_id=s),onChange:e[1]||(e[1]=s=>S(l(o).purchase_order_id)),class:"w-full rounded-xl border-0 bg-slate-50 dark:bg-slate-800 py-2.5 text-slate-900 dark:text-white focus:ring-2 focus:ring-blue-500/50"},[e[7]||(e[7]=t("option",{value:null},"Select PO (Optional)",-1)),(n(!0),d(x,null,g(b.purchaseOrders,s=>(n(),d("option",{key:s.id,value:s.id},c(s.po_number)+" - "+c(s.supplier?.name),9,G))),128))],544),[[v,l(o).purchase_order_id]])]),t("div",null,[e[10]||(e[10]=t("label",{class:"block text-sm font-medium text-slate-500 dark:text-slate-400 mb-1"},"Supplier",-1)),p(t("select",{"onUpdate:modelValue":e[2]||(e[2]=s=>l(o).supplier_id=s),class:"w-full rounded-xl border-0 bg-slate-50 dark:bg-slate-800 py-2.5 text-slate-900 dark:text-white focus:ring-2 focus:ring-blue-500/50",required:""},[e[9]||(e[9]=t("option",{value:""},"Select Supplier",-1)),(n(!0),d(x,null,g(b.suppliers,s=>(n(),d("option",{key:s.id,value:s.id},c(s.name),9,L))),128))],512),[[v,l(o).supplier_id]])]),t("div",null,[e[12]||(e[12]=t("label",{class:"block text-sm font-medium text-slate-500 dark:text-slate-400 mb-1"},"Warehouse",-1)),p(t("select",{"onUpdate:modelValue":e[3]||(e[3]=s=>l(o).warehouse_id=s),class:"w-full rounded-xl border-0 bg-slate-50 dark:bg-slate-800 py-2.5 text-slate-900 dark:text-white focus:ring-2 focus:ring-blue-500/50",required:""},[e[11]||(e[11]=t("option",{value:""},"Select Warehouse",-1)),(n(!0),d(x,null,g(b.warehouses,s=>(n(),d("option",{key:s.id,value:s.id},c(s.name),9,Q))),128))],512),[[v,l(o).warehouse_id]])]),t("div",null,[e[13]||(e[13]=t("label",{class:"block text-sm font-medium text-slate-500 dark:text-slate-400 mb-1"},"Receipt Date",-1)),p(t("input",{type:"date","onUpdate:modelValue":e[4]||(e[4]=s=>l(o).receipt_date=s),class:"w-full rounded-xl border-0 bg-slate-50 dark:bg-slate-800 py-2.5 text-slate-900 dark:text-white focus:ring-2 focus:ring-blue-500/50",required:""},null,512),[[f,l(o).receipt_date]])])]),t("div",H,[t("div",J,[e[16]||(e[16]=t("h3",{class:"text-lg font-semibold text-slate-900 dark:text-white"},"Items Received",-1)),t("button",{type:"button",onClick:O,class:"text-sm font-medium text-blue-400 hover:text-blue-300 flex items-center gap-1"},[u(l(D),{class:"h-4 w-4"}),e[15]||(e[15]=h(" Add Item ",-1))])]),t("div",K,[e[20]||(e[20]=t("div",{class:"grid grid-cols-12 gap-3 px-3 py-2 mb-2 hidden sm:grid sticky top-0 z-10 bg-white dark:bg-slate-900 border-b border-slate-100 dark:border-slate-800"},[t("div",{class:"col-span-12 sm:col-span-5"},[t("span",{class:"text-[10px] font-bold text-slate-500 uppercase"},"Product")]),t("div",{class:"col-span-4 sm:col-span-2 text-right pr-2"},[t("span",{class:"text-[10px] font-bold text-slate-500 uppercase"},"Qty")]),t("div",{class:"col-span-4 sm:col-span-3 text-right pr-2"},[t("span",{class:"text-[10px] font-bold text-slate-500 uppercase"},"Unit Cost")]),t("div",{class:"col-span-4 sm:col-span-2"})],-1)),(n(!0),d(x,null,g(l(o).items,(s,a)=>(n(),d("div",{key:a,class:"grid grid-cols-12 gap-3 items-end bg-slate-50 dark:bg-slate-800/30 p-3 rounded-xl hover:bg-slate-50 dark:hover:bg-slate-800/50 dark:bg-slate-900 dark:bg-slate-800/50 transition-colors"},[t("div",X,[e[17]||(e[17]=t("label",{class:"block text-[10px] font-bold text-slate-500 uppercase mb-1 sm:hidden"},"Product",-1)),u(I,{modelValue:s.product_id,"onUpdate:modelValue":i=>s.product_id=i,options:q.value,onChange:i=>V(a,i),placeholder:"Search Product..."},null,8,["modelValue","onUpdate:modelValue","options","onChange"])]),t("div",Y,[e[18]||(e[18]=t("label",{class:"block text-[10px] font-bold text-slate-500 uppercase mb-1 sm:hidden"},"Qty",-1)),p(t("input",{type:"number","onUpdate:modelValue":i=>s.qty_received=i,min:"0.0001",step:"any",class:$(["w-full rounded-lg border-0 bg-slate-50 dark:bg-slate-800 py-2.5 text-xs text-slate-900 dark:text-white focus:ring-1 focus:ring-blue-500 text-right transition-colors",{"ring-1 ring-red-500 bg-red-500/10":k(s),"ring-1 ring-amber-500 bg-amber-500/10":y(s)}]),required:""},null,10,Z),[[f,s.qty_received]]),k(s)?(n(),d("div",ee," Max Allowed: "+c(Math.round(s.remaining_qty*1.1)),1)):y(s)?(n(),d("div",te," Over PO (Tolerance 10%) ")):A("",!0)]),t("div",se,[e[19]||(e[19]=t("label",{class:"block text-[10px] font-bold text-slate-500 uppercase mb-1 sm:hidden"},"Unit Cost",-1)),p(t("input",{type:"number","onUpdate:modelValue":i=>s.unit_cost=i,onChange:i=>s.unit_cost=Math.round(s.unit_cost),step:"any",class:"w-full rounded-lg border-0 bg-slate-50 dark:bg-slate-800 py-2.5 text-xs text-slate-900 dark:text-white focus:ring-1 focus:ring-blue-500 text-right",required:""},null,40,re),[[f,s.unit_cost]])]),t("div",oe,[t("button",{type:"button",onClick:i=>C(a),class:"p-2 text-slate-500 hover:text-red-400 rounded-lg hover:bg-slate-700/50 transition-colors"},[u(l(T),{class:"h-4 w-4"})],8,le)])]))),128))])])]),t("div",ae,[e[21]||(e[21]=t("label",{class:"block text-sm font-medium text-slate-500 dark:text-slate-400 mb-2"},"Notes",-1)),p(t("textarea",{"onUpdate:modelValue":e[5]||(e[5]=s=>l(o).notes=s),rows:"2",class:"w-full rounded-xl border-0 bg-slate-50 dark:bg-slate-800 text-slate-900 dark:text-white focus:ring-2 focus:ring-blue-500/50",placeholder:"Optional notes..."},null,512),[[f,l(o).notes]])]),t("div",de,[u(l(w),{href:"/purchasing/receipts",class:"px-6 py-2.5 rounded-xl bg-slate-50 dark:bg-slate-800 text-sm font-semibold text-slate-600 dark:text-slate-300 hover:bg-slate-700"},{default:_(()=>[...e[22]||(e[22]=[h("Cancel",-1)])]),_:1}),t("button",{type:"submit",class:"px-6 py-2.5 rounded-xl bg-blue-600 text-sm font-semibold text-white dark:text-white hover:bg-blue-500 shadow-lg shadow-blue-900/20",disabled:l(o).processing},c(l(o).processing?"Saving...":"Save Receipt"),9,ne)])],32)])]),_:1})],64))}};export{Pe as default};
